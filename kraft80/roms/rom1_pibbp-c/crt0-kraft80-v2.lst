ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 1.
Hexadecimal [24-Bits]



                                      1 ;--------------------------------------------------------------------------
                                      2 ;  crt0.s - Generic crt0.s for a Z80
                                      3 ;
                                      4 ;  Copyright (C) 2000, Michael Hope
                                      5 ;
                                      6 ;  This library is free software; you can redistribute it and/or modify it
                                      7 ;  under the terms of the GNU General Public License as published by the
                                      8 ;  Free Software Foundation; either version 2, or (at your option) any
                                      9 ;  later version.
                                     10 ;
                                     11 ;  This library is distributed in the hope that it will be useful,
                                     12 ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     13 ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                     14 ;  GNU General Public License for more details.
                                     15 ;
                                     16 ;  You should have received a copy of the GNU General Public License 
                                     17 ;  along with this library; see the file COPYING. If not, write to the
                                     18 ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                     19 ;   MA 02110-1301, USA.
                                     20 ;
                                     21 ;  As a special exception, if you link this library with other files,
                                     22 ;  some of which are compiled with SDCC, to produce an executable,
                                     23 ;  this library does not by itself cause the resulting executable to
                                     24 ;  be covered by the GNU General Public License. This exception does
                                     25 ;  not however invalidate any other reasons why the executable file
                                     26 ;  might be covered by the GNU General Public License.
                                     27 ;--------------------------------------------------------------------------
                                     28 
                                     29 ;;;-----------------------------------------------------------------------
                                     30 ;;; INTERRUPT HANDLERS & VECTORS
                                     31 ;;; HARDWARE DRIVERS FOR THE TANG NANO HARDWARE:
                                     32 ;;;    VIDEO, SERIAL, TIMER & PS/2 KEYBOARD
                                     33 ;;;    BY ARMCODER - 2025
                                     34 ;;;-----------------------------------------------------------------------
                                     35 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 2.
Hexadecimal [24-Bits]



                                     36 	.include "defines.s"
                                      1 ; defines for a standalone ROM app (no monitor, no BASIC)
                           010000     2 RAMTOP		.equ 0x10000
                           00FF00     3 STACKTOP	.equ RAMTOP - 0x100
                           00FFFE     4 timecount	.equ RAMTOP-2		;0xfffe
                                      5 
                                      6 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 3.
Hexadecimal [24-Bits]



                                     37 
                                     38 ;RAMBASE		.equ 0x4000
                                     39 ;STACKTOP	.equ RAMBASE+0x100	;0x4100
                           00FF00    40 isr0vector	.equ STACKTOP
                           00FF02    41 isr1vector	.equ STACKTOP+2		;0x4102
                           00FF04    42 isr2vector	.equ STACKTOP+4		;0x4104
                           00FF06    43 isr3vector	.equ STACKTOP+6		;0x4106
                           00FF08    44 isr4vector	.equ STACKTOP+8		;0x4108
                           00FF0A    45 isr5vector	.equ STACKTOP+10	;0x410a
                           00FF0C    46 isr6vector	.equ STACKTOP+12	;0x410c
                           00FF0E    47 isr7vector	.equ STACKTOP+14	;0x410e
                           000080    48 BUFRXSIZE	.equ 0x80
                           00FF10    49 bufrx		.equ STACKTOP+16	;0x4110
                           00FF90    50 bufrxins	.equ bufrx+BUFRXSIZE	;0x4190
                           00FF91    51 bufrxget	.equ bufrxins+1		;0x4191
                           00FF92    52 bufrxqty	.equ bufrxget+1		;0x4192
                                     53 
                           00003C    54 VIDROWS		.equ	60
                           000050    55 VIDCOLS		.equ	80
                           000050    56 VIDBUFSZ	.equ	VIDCOLS	;(VIDCOLS/4)
                           00FF93    57 vidrow		.equ bufrxqty+1		;0x4193
                           00FF94    58 vidcol		.equ vidrow+1		;0x4194
                           00FF95    59 vidptr		.equ vidcol+1		;0x4195
                           00FF97    60 vidbuf		.equ vidptr+2		;0x4197
                           000008    61 BUFKEYSIZE	.equ	8
                           00FFE7    62 bufkey		.equ vidbuf+VIDBUFSZ	;0x41e7		
                           00FFEF    63 bufkeyqty	.equ bufkey+BUFKEYSIZE	;0x41ef
                           00FFF0    64 bufkeyins	.equ bufkeyqty+1	;0x41f0
                           00FFF1    65 bufkeyget	.equ bufkeyins+1	;0x41f1
                           00FFF2    66 kflags		.equ bufkeyget+1	;0x41f2	;00xxxxxx
                                     67 						;  |||||`-- LShift
                                     68 						;  ||||`--- RShift
                                     69 						;  |||`---- Caps
                                     70 						;  ||`----- Break Code Indicator
                                     71 						;  |`------ LCTRL  
                                     72 						;  `------- RCTRL (reserved)   
                           00FFF3    73 lastkey		.equ kflags+1		;0x41f3
                           00FFF4    74 sysflag		.equ lastkey+1		;0x41f4
                                     75 
                           00FFF4    76 __varend__	.equ lastkey+1
                                     77 
                                     78 ;RAMTOP		.equ RAMBASE+0x200	;0x4200
                                     79 ;timecount	.equ RAMTOP-2		;0x41fe
                                     80 
                           000000    81 PORTLEDS	.equ 0x00
                                     82 
                                     83 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     84 ; LEDS & BUTTONS
                           000000    85 PORTLEDS	.equ	0x00
                           000000    86 PORTBUTTONS	.equ	0x00
                                     87 
                                     88 ; FPGA addr mapping (base 0x50)
                                     89 ; 0000: Video RAM Data (R/W)
                                     90 ; 0001: Video ADDR Low (W)
                                     91 ; 0010: Video ADDR High (W)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 4.
Hexadecimal [24-Bits]



                                     92 ; 0011: Video control (W)
                                     93 ; 0100: Timer Status & Control(R/W)
                                     94 ; 0101: PS/2 RX Data (R)
                                     95 ; 0110: Sound REG Index (W)
                                     96 ; 0111: Sound REG Data (W)
                                     97 ; 1000: Serial Status & Control (R/W)
                                     98 ; 1001: Serial Data RX/TX (R/W)
                                     99 ; 1010
                                    100 ; 1011
                                    101 ; 1100
                                    102 ; 1101
                                    103 ; 1110
                                    104 ; 1111: Status Reg (R)
                                    105 
                                    106 ; FPGA
                                    107 ;   VIDEO
                           000050   108 PORTDATA	.equ	0x50	; Video ports
                           000051   109 PORTADDRL	.equ	0x51
                           000052   110 PORTADDRH	.equ	0x52
                           000053   111 PORTMODE	.equ	0x53
                                    112 
                                    113 ; TIMER STATUS/CONTROL
                           000054   114 PORTTIMER	.equ	0x54
                                    115 
                                    116 ;   PS2 KEYBOARD
                           000055   117 PORTKEY		.equ	0x55
                                    118 
                                    119 ; AUDIO
                           000056   120 PORTAYADDR	.equ	0x56
                           000057   121 PORTAYDATA	.equ	0x57
                                    122 
                                    123 ; SERIAL
                           000058   124 PORTSERSTATUS	.equ	0x58
                           000058   125 PORTSERCTL	.equ	0x58
                           000002   126 	PORTSER_EN	.equ	2
                           000001   127 	PORTSER_RTSON	.equ	1
                           000000   128 	PORTSER_DIS	.equ	0
                           000000   129 	PORTSER_RTSOFF	.equ	0
                                    130 
                           000059   131 PORTSERDATA	.equ	0x59
                                    132 
                                    133 ;   FPGA STATUS
                           00005F   134 PORTFPGASTATUS	.equ	0x5F
                                    135 
                                    136 	.module crt0
                                    137 	.globl	_main
                                    138 	.globl	prints
                                    139 
                                    140 	.area	_HEADER (ABS)
                                    141 	;; Reset vector
      000000                        142 	.org 	0
      000000 C3 00 01         [10]  143 	jp	init
                                    144 
      000008                        145 	.org	0x08
      000008 C3 D5 00         [10]  146 	jp	mon_putchar
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 5.
Hexadecimal [24-Bits]



                                    147 
      000010                        148 	.org	0x10
      000010 C3 E2 00         [10]  149 	jp	mon_getchar
                                    150 
      000018                        151 	.org	0x18
      000018 C3 EF 00         [10]  152 	jp	mon_haskey
                                    153 	
      000020                        154 	.org	0x20
      000020 C3 A1 01         [10]  155 	jp	serial_fns
      000028                        156 	.org	0x28
      000028 ED 4D            [14]  157 	reti
      000030                        158 	.org	0x30
      000030 ED 4D            [14]  159 	reti
                                    160 
                                    161 	;///////////////////////////////////////////////////////////////////////
                                    162 	;//////////////////////////   ISR DISPATCH   ///////////////////////////
                                    163 	;///////////////////////////////////////////////////////////////////////
      000038                        164 	.org	0x38
                                    165 
      000038 F5               [11]  166 fpga_isr:	push	af
      000039 E5               [11]  167 		push	hl
                                    168 
      00003A DB 5F            [11]  169 fpga_isrloop:	in	a,(PORTFPGASTATUS)
      00003C E6 07            [ 7]  170 		and	#0x07
      00003E 28 2A            [12]  171 		jr	z,fpga_isrend
                                    172 
      000040 CB 47            [ 8]  173 		bit	0,a			; Has PS/2 interrupt?
      000042 28 08            [12]  174 		jr	z,fpga_isr1		; No
                                    175 
      000044 21 4C 00         [10]  176 		ld	hl,#fpga_isr1
      000047 E5               [11]  177 		push	hl
      000048 2A 02 FF         [16]  178 		ld	hl,(isr1vector)
      00004B E9               [ 4]  179 		jp	(hl)
                                    180 
      00004C DB 5F            [11]  181 fpga_isr1:	in	a,(PORTFPGASTATUS)	; Has timer interrupt?
      00004E CB 4F            [ 8]  182 		bit	1,a			; No
      000050 28 0A            [12]  183 		jr	z,fpga_isr2
                                    184 
      000052 DB 54            [11]  185 		in	a,(PORTTIMER)		; Timer EOI
      000054 21 5C 00         [10]  186 		ld	hl,#fpga_isr2
      000057 E5               [11]  187 		push	hl
      000058 2A 04 FF         [16]  188 		ld	hl,(isr2vector)
      00005B E9               [ 4]  189 		jp	(hl)
                                    190 
      00005C DB 5F            [11]  191 fpga_isr2:	in	a,(PORTFPGASTATUS)	; Has Serial RX interrupt?
      00005E CB 57            [ 8]  192 		bit	2,a			; No
      000060 28 D8            [12]  193 		jr	z,fpga_isrloop
                                    194 
                                    195 	;;;;	in	a,(PORTSERDATA)
      000062 21 3A 00         [10]  196 		ld	hl,#fpga_isrloop
      000065 E5               [11]  197 		push	hl
      000066 2A 00 FF         [16]  198 		ld	hl,(isr0vector)
      000069 E9               [ 4]  199 		jp	(hl)
                                    200 
      00006A E1               [10]  201 fpga_isrend:	pop	hl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 6.
Hexadecimal [24-Bits]



      00006B F1               [10]  202 		pop	af
      00006C FB               [ 4]  203 		ei
      00006D ED 4D            [14]  204 		reti
                                    205 
                                    206 	;///////////////////////////////////////////////////////////////////////
                                    207 
                                    208 
      00006F                        209 timer_isr:
      00006F 3A FE FF         [13]  210 		ld	a,(timecount)
      000072 3C               [ 4]  211 		inc	a
      000073 32 FE FF         [13]  212 		ld	(timecount),a
                                    213 		;out	(PORTLEDS),a
      000076 C9               [10]  214 		ret
                                    215 
                                    216 
      000077                        217 ps2_isr:
      000077 3A EF FF         [13]  218 		ld	a,(bufkeyqty)
      00007A FE 08            [ 7]  219 		cp	#BUFKEYSIZE
      00007C 20 03            [12]  220 		jr	nz,key_isr1
      00007E DB 55            [11]  221 		in	a,(PORTKEY)
      000080 C9               [10]  222 		ret
                                    223 
      000081 3C               [ 4]  224 key_isr1:	inc	a
      000082 32 EF FF         [13]  225 		ld	(bufkeyqty),a
                                    226 
      000085 3A F0 FF         [13]  227 		ld	a,(bufkeyins)
      000088 C5               [11]  228 		push	bc
      000089 4F               [ 4]  229 		ld	c,a
      00008A 06 00            [ 7]  230 		ld	b,#0
      00008C E5               [11]  231 		push	hl
      00008D 21 E7 FF         [10]  232 		ld	hl,#bufkey
      000090 09               [11]  233 		add	hl,bc
      000091 DB 55            [11]  234 		in	a,(PORTKEY)	; Read key -> PS/2 EOI
      000093 77               [ 7]  235 		ld	(hl),a
      000094 E1               [10]  236 		pop	hl
      000095 79               [ 4]  237 		ld	a,c
      000096 C1               [10]  238 		pop	bc
      000097 3C               [ 4]  239 		inc	a
      000098 FE 08            [ 7]  240 		cp	#BUFKEYSIZE
      00009A 38 01            [12]  241 		jr	c,key_isr2
      00009C AF               [ 4]  242 		xor	a
      00009D 32 F0 FF         [13]  243 key_isr2:	ld	(bufkeyins),a
      0000A0 C9               [10]  244 		ret
                                    245 
                                    246 
      0000A1 3A 92 FF         [13]  247 rx_isr:		ld	a,(bufrxqty)
      0000A4 FE 80            [ 7]  248 		cp	#BUFRXSIZE
      0000A6 20 03            [12]  249 		jr	nz,rx_isr1
      0000A8 DB 59            [11]  250 		in	a,(PORTSERDATA)
      0000AA C9               [10]  251 		ret
                                    252 	
      0000AB 3C               [ 4]  253 rx_isr1:	inc	a
      0000AC FE 70            [ 7]  254 		cp	#(BUFRXSIZE-16)
      0000AE 20 06            [12]  255 		jr	nz,rx_isr1a
                                    256 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 7.
Hexadecimal [24-Bits]



      0000B0 F5               [11]  257 		push	af
      0000B1 3E 02            [ 7]  258 		ld	a,#(PORTSER_EN|PORTSER_RTSOFF)
      0000B3 D3 58            [11]  259 		out	(PORTSERCTL),a
      0000B5 F1               [10]  260 		pop	af
                                    261 
      0000B6 32 92 FF         [13]  262 rx_isr1a:	ld	(bufrxqty),a
      0000B9 3A 90 FF         [13]  263 		ld	a,(bufrxins)
      0000BC C5               [11]  264 		push	bc
      0000BD 4F               [ 4]  265 		ld	c,a
      0000BE 06 00            [ 7]  266 		ld	b,#0
      0000C0 E5               [11]  267 		push	hl
      0000C1 21 10 FF         [10]  268 		ld	hl,#bufrx
      0000C4 09               [11]  269 		add	hl,bc
      0000C5 DB 59            [11]  270 		in	a,(PORTSERDATA)
      0000C7 77               [ 7]  271 		ld	(hl),a
      0000C8 E1               [10]  272 		pop	hl
      0000C9 79               [ 4]  273 		ld	a,c
      0000CA C1               [10]  274 		pop	bc
                                    275 
      0000CB 3C               [ 4]  276 		inc	a
      0000CC FE 80            [ 7]  277 		cp	#BUFRXSIZE
      0000CE 38 01            [12]  278 		jr	c,rx_isr2
      0000D0 AF               [ 4]  279 		xor	a
                                    280 
      0000D1 32 90 FF         [13]  281 rx_isr2:	ld	(bufrxins),a
                                    282 
      0000D4 C9               [10]  283 		ret
                                    284 
                                    285 
                                    286 	;///////////////////////////////////////////////////////////////////////
      0000D5                        287 mon_putchar:
      0000D5 E5               [11]  288 	push	hl
      0000D6 21 F4 FF         [10]  289 	ld	hl,#sysflag
      0000D9 CB 46            [12]  290 	bit	0,(hl)
      0000DB E1               [10]  291 	pop	hl
      0000DC C2 AE 01         [10]  292 	jp	nz,tx_char	; Serial
      0000DF C3 FE 01         [10]  293 	jp	putchar		; VGA out
                                    294 
      0000E2                        295 mon_getchar:
      0000E2 E5               [11]  296 	push	hl
      0000E3 21 F4 FF         [10]  297 	ld	hl,#sysflag
      0000E6 CB 46            [12]  298 	bit	0,(hl)
      0000E8 E1               [10]  299 	pop	hl
      0000E9 C2 BC 01         [10]  300 	jp	nz,rx_char	; Serial
      0000EC C3 08 03         [10]  301 	jp	readkey		; PS/2 keyboard
                                    302 	
      0000EF                        303 mon_haskey:
      0000EF E5               [11]  304 	push	hl
      0000F0 21 F4 FF         [10]  305 	ld	hl,#sysflag
      0000F3 CB 46            [12]  306 	bit	0,(hl)
      0000F5 E1               [10]  307 	pop	hl
      0000F6 C2 B7 01         [10]  308 	jp	nz,has_rxchar	; Serial
      0000F9 C3 FA 02         [10]  309 	jp	keypressed	; PS/2 keyboard
                                    310 
                                    311 	;///////////////////////////////////////////////////////////////////////
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 8.
Hexadecimal [24-Bits]



                                    312 	;////////////////////////   INITIALIZATION   ///////////////////////////
                                    313 	;///////////////////////////////////////////////////////////////////////
                                    314 
      000100                        315 .org	0x100
      000100                        316 init:
                                    317 	;; Stack at the top of memory.
      000100 31 00 FF         [10]  318 	ld	sp,#STACKTOP
                                    319 
      000103 21 A1 00         [10]  320 	ld	hl,#rx_isr
      000106 22 00 FF         [16]  321 	ld	(isr0vector),hl
      000109 21 77 00         [10]  322 	ld	hl,#ps2_isr
      00010C 22 02 FF         [16]  323 	ld	(isr1vector),hl
      00010F 21 6F 00         [10]  324 	ld	hl,#timer_isr
      000112 22 04 FF         [16]  325 	ld	(isr2vector),hl
                                    326 
      000115 3E F0            [ 7]  327 	ld	a,#0xf0
      000117 32 FE FF         [13]  328 	ld	(timecount),a
                                    329 
      00011A AF               [ 4]  330 	xor	a
      00011B 32 90 FF         [13]  331 	ld	(bufrxins),a
      00011E 32 91 FF         [13]  332 	ld	(bufrxget),a
      000121 32 92 FF         [13]  333 	ld	(bufrxqty),a
                                    334 
      000124 32 EF FF         [13]  335 	ld	(bufkeyqty),a
      000127 32 F0 FF         [13]  336 	ld	(bufkeyins),a
      00012A 32 F1 FF         [13]  337 	ld	(bufkeyget),a
      00012D 32 F2 FF         [13]  338 	ld	(kflags),a
      000130 32 F3 FF         [13]  339 	ld	(lastkey),a
      000133 32 F4 FF         [13]  340 	ld	(sysflag),a
                                    341 
      000136 DB 00            [11]  342 	in	a,(PORTBUTTONS)
      000138 CB 7F            [ 8]  343 	bit	7,a
      00013A 20 05            [12]  344 	jr	nz,init1
                                    345 
      00013C 3E 01            [ 7]  346 	ld	a,#1
      00013E 32 F4 FF         [13]  347 	ld	(sysflag),a
      000141                        348 init1:
      000141 3E 01            [ 7]  349 		ld	a,#1
      000143 D3 54            [11]  350 		out	(PORTTIMER),a
      000145 3E 03            [ 7]  351 		ld	a,#(PORTSER_EN|PORTSER_RTSON)
      000147 D3 58            [11]  352 		out	(PORTSERCTL),a	; Enable RTS & INT RX
                                    353 
                                    354         ;; Initialise global variables
      000149 CD AD 04         [17]  355         call    gsinit
                                    356         
                                    357 
      00014C AF               [ 4]  358 	xor 	a
      00014D D3 53            [11]  359 	out	(PORTMODE),a
                                    360 	
      00014F 21 00 00         [10]  361 	ld	hl,#0
      000152 2B               [ 6]  362 wait1:	dec	hl
      000153 7C               [ 4]  363 	ld	a,h
      000154 B5               [ 4]  364 	or	l
      000155 20 FB            [12]  365 	jr	nz,wait1
                                    366 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 9.
Hexadecimal [24-Bits]



                                    367 	; Init CRT Video
      000157 AF               [ 4]  368 	xor 	a
      000158 D3 51            [11]  369 	out	(PORTADDRL),a
      00015A D3 52            [11]  370 	out	(PORTADDRH),a
      00015C 32 93 FF         [13]  371 	ld	(vidrow),a
      00015F 32 94 FF         [13]  372 	ld	(vidcol),a
      000162 32 95 FF         [13]  373 	ld	(vidptr),a
      000165 32 96 FF         [13]  374 	ld	(vidptr+1),a
                                    375 
      000168 21 7C 01         [10]  376 	ld	hl,#signon
      00016B CD 98 01         [17]  377 	call	prints
                                    378 
                                    379 	;in	a,(PORTBUTTONS)
                                    380 	;bit	6,a
                                    381 	;jp	nz,0x2000		; ROM Basic
                                    382 
      00016E DB 59            [11]  383 	in	a,(PORTSERDATA)
      000170 DB 55            [11]  384 	in	a,(PORTKEY)
      000172 DB 54            [11]  385 	in	a,(PORTTIMER)
                                    386 	
      000174 ED 56            [ 8]  387 	im	1
      000176 FB               [ 4]  388 	ei
                                    389 
      000177 CD 00 00         [17]  390 	call	_main
      00017A F3               [ 4]  391 	di
      00017B 76               [ 4]  392 	halt
                                    393 
      00017C                        394 signon:
      00017C 0D 0A                  395 	.db	13,10
      00017E 4B 72 61 66 74 20 38   396 	.ascii	'Kraft 80 - Z80 Computer'
             30 20 2D 20 5A 38 30
             20 43 6F 6D 70 75 74
             65 72
      000195 0D 0A 00               397 	.db	13,10,0
                                    398 	
                                    399 	;///////////////////////////////////////////////////////////////////////
      000198                        400 prints:
      000198 7E               [ 7]  401 	ld	a,(hl)
      000199 B7               [ 4]  402 	or	a
      00019A C8               [11]  403 	ret	z
      00019B E5               [11]  404 	push	hl
      00019C CF               [11]  405 	rst	#0x08
      00019D E1               [10]  406 	pop	hl
      00019E 23               [ 6]  407 	inc	hl
      00019F 18 F7            [12]  408 	jr	prints
                                    409 
                                    410 	;///////////////////////////////////////////////////////////////////////
                                    411 	;////////////////////   SERIAL (UART) FUNCTIONS   //////////////////////
                                    412 	;///////////////////////////////////////////////////////////////////////
                                    413 
      0001A1                        414 serial_fns:
      0001A1 CB 41            [ 8]  415 	bit	0,c		;c = 1: TX CHAR (input in A)
      0001A3 20 09            [12]  416 	jr	nz,tx_char
                                    417 
      0001A5 CB 49            [ 8]  418 	bit	1,c		;c = 2: HAS RXCHAR (output Z flag)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 10.
Hexadecimal [24-Bits]



      0001A7 20 0E            [12]  419 	jr	nz,has_rxchar
                                    420 
      0001A9 CB 51            [ 8]  421 	bit	2,c		;c = 4: RX CHAR (outputs Z flag & A)
      0001AB 20 0F            [12]  422 	jr	nz,rx_char
                                    423 
      0001AD C9               [10]  424 	ret
                                    425 
                                    426 	;///////////////////////////////////////////////////////////////////////
      0001AE                        427 tx_char:
                                    428         ;di
      0001AE D3 59            [11]  429 	out	(PORTSERDATA),a
      0001B0                        430 wait_tx:
      0001B0 DB 58            [11]  431 	in	a,(PORTSERSTATUS)
      0001B2 CB 4F            [ 8]  432 	bit	1,a
      0001B4 20 FA            [12]  433 	jr	nz,wait_tx
                                    434 	;ei
      0001B6 C9               [10]  435 	ret
                                    436 
                                    437 	;///////////////////////////////////////////////////////////////////////
      0001B7                        438 has_rxchar:
      0001B7 3A 92 FF         [13]  439 	ld	a,(bufrxqty)
      0001BA B7               [ 4]  440 	or	a
      0001BB C9               [10]  441 	ret
                                    442 
                                    443 	;///////////////////////////////////////////////////////////////////////
      0001BC                        444 rx_char:
      0001BC 3A 92 FF         [13]  445 	ld	a,(bufrxqty)
      0001BF B7               [ 4]  446 	or	a
      0001C0 20 01            [12]  447 	jr	nz,rx_char0
      0001C2 C9               [10]  448 	ret		;; No char available, return Z
                                    449 
      0001C3                        450 rx_char0:
      0001C3 F3               [ 4]  451 	di
      0001C4 3A 92 FF         [13]  452 	ld	a,(bufrxqty)
      0001C7 3D               [ 4]  453 	dec	a
      0001C8 32 92 FF         [13]  454 	ld	(bufrxqty),a
      0001CB FE 08            [ 7]  455 	cp	#8
      0001CD 20 04            [12]  456 	jr	nz,rx_char2
                                    457 
      0001CF 3E 03            [ 7]  458 		ld	a,#(PORTSER_EN|PORTSER_RTSON)
      0001D1 D3 58            [11]  459 		out	(PORTSERCTL),a	; Enable RTS & INT RX
                                    460 
      0001D3                        461 rx_char2:
      0001D3 E5               [11]  462 	push	hl
                                    463 
      0001D4 C5               [11]  464 	push	bc
      0001D5 3A 91 FF         [13]  465 	ld	a,(bufrxget)
      0001D8 4F               [ 4]  466 	ld	c,a
      0001D9 06 00            [ 7]  467 	ld	b,#0
      0001DB 21 10 FF         [10]  468 	ld	hl,#bufrx
      0001DE 09               [11]  469 	add	hl,bc
      0001DF C1               [10]  470 	pop	bc
                                    471 
      0001E0 3C               [ 4]  472 	inc	a
      0001E1 FE 80            [ 7]  473 	cp	#BUFRXSIZE
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 11.
Hexadecimal [24-Bits]



      0001E3 20 03            [12]  474 	jr	nz,rx_char1	;; Condition NZ
                                    475 
      0001E5 AF               [ 4]  476 	xor	a
      0001E6 FE 01            [ 7]  477 	cp	#1		;; Force condition NZ
                                    478 
      0001E8                        479 rx_char1:
      0001E8 32 91 FF         [13]  480 	ld	(bufrxget),a
      0001EB 7E               [ 7]  481 	ld	a,(hl)
      0001EC E1               [10]  482 	pop	hl
      0001ED FB               [ 4]  483 	ei
      0001EE C9               [10]  484 	ret			;; Always return NZ
                                    485 
                                    486 	;///////////////////////////////////////////////////////////////////////
                                    487 	;//////////////////////   CRT (VGA) FUNCTIONS   ////////////////////////
                                    488 	;///////////////////////////////////////////////////////////////////////
                                    489 
      0001EF 3A 94 FF         [13]  490 putbs:	ld	a,(vidcol)
      0001F2 B7               [ 4]  491 	or	a
      0001F3 C8               [11]  492 	ret	z
      0001F4 3D               [ 4]  493 	dec	a
      0001F5 32 94 FF         [13]  494 	ld	(vidcol),a
      0001F8 2A 95 FF         [16]  495 	ld	hl,(vidptr)
      0001FB 2B               [ 6]  496 	dec	hl
      0001FC 18 7D            [12]  497 	jr	putlf2
                                    498 
      0001FE                        499 putchar:
      0001FE F5               [11]  500 	push	af
      0001FF E5               [11]  501 	push	hl
      000200 CD 06 02         [17]  502 	call	_putchar
      000203 E1               [10]  503 	pop	hl
      000204 F1               [10]  504 	pop	af
      000205 C9               [10]  505 	ret
                                    506 
      000206                        507 _putchar:
      000206 FE 0D            [ 7]  508 	cp	#13
      000208 28 40            [12]  509 	jr	z,putcr
      00020A FE 0A            [ 7]  510 	cp	#10
      00020C 28 59            [12]  511 	jr	z,putlf
      00020E FE 0C            [ 7]  512 	cp	#12
      000210 28 76            [12]  513 	jr	z,putclr
      000212 FE 08            [ 7]  514 	cp	#8
      000214 28 D9            [12]  515 	jr	z,putbs
                                    516 	
      000216 D3 50            [11]  517 	out	(PORTDATA),a
      000218 2A 95 FF         [16]  518 	ld	hl,(vidptr)
      00021B 23               [ 6]  519 	inc	hl
      00021C 22 95 FF         [16]  520 	ld	(vidptr),hl
                                    521 
      00021F 3A 94 FF         [13]  522 	ld	a,(vidcol)
      000222 FE 4F            [ 7]  523 	cp	#(VIDCOLS-1)
      000224 28 05            [12]  524 	jr	z,putcnextrow
      000226 3C               [ 4]  525 	inc	a
      000227 32 94 FF         [13]  526 	ld	(vidcol),a
      00022A C9               [10]  527 	ret
                                    528 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 12.
Hexadecimal [24-Bits]



      00022B                        529 putcnextrow:
      00022B AF               [ 4]  530 	xor	a
      00022C 32 94 FF         [13]  531 	ld	(vidcol),a
      00022F 3A 93 FF         [13]  532 	ld	a,(vidrow)
      000232 FE 3B            [ 7]  533 	cp	#(VIDROWS-1)
      000234 28 05            [12]  534 	jr	z,nextrow1
      000236 3C               [ 4]  535 	inc	a
      000237 32 93 FF         [13]  536 	ld	(vidrow),a
      00023A C9               [10]  537 	ret
                                    538 
      00023B                        539 nextrow1:
      00023B 2A 95 FF         [16]  540 	ld	hl,(vidptr)
      00023E D5               [11]  541 	push	de
      00023F 11 B0 FF         [10]  542 	ld	de,#-VIDCOLS
      000242 19               [11]  543 	add	hl,de
      000243 D1               [10]  544 	pop	de
      000244 22 95 FF         [16]  545 	ld	(vidptr),hl
      000247 C3 AA 02         [10]  546 	jp	scroll_crt
                                    547 
      00024A 3A 94 FF         [13]  548 putcr:	ld	a,(vidcol)
      00024D B7               [ 4]  549 	or	a
      00024E C8               [11]  550 	ret	z
      00024F D5               [11]  551 	push	de
      000250 5F               [ 4]  552 	ld	e,a
      000251 16 00            [ 7]  553 	ld	d,#0
      000253 2A 95 FF         [16]  554 	ld	hl,(vidptr)
      000256 AF               [ 4]  555 	xor	a
      000257 32 94 FF         [13]  556 	ld	(vidcol),a
      00025A ED 52            [15]  557 	sbc	hl,de
      00025C D1               [10]  558 	pop	de
      00025D 22 95 FF         [16]  559 	ld	(vidptr),hl
      000260 7D               [ 4]  560 	ld	a,l
      000261 D3 51            [11]  561 	out	(PORTADDRL),a
      000263 7C               [ 4]  562 	ld	a,h
      000264 D3 52            [11]  563 	out	(PORTADDRH),a
      000266 C9               [10]  564 	ret
                                    565 	
      000267 3A 93 FF         [13]  566 putlf:	ld	a,(vidrow)
      00026A FE 3B            [ 7]  567 	cp	#(VIDROWS-1)
      00026C 28 17            [12]  568 	jr	z,putlf1
                                    569 	
      00026E 3C               [ 4]  570 	inc	a
      00026F 32 93 FF         [13]  571 	ld	(vidrow),a
      000272 2A 95 FF         [16]  572 	ld	hl,(vidptr)
      000275 D5               [11]  573 	push	de
      000276 11 50 00         [10]  574 	ld	de,#VIDCOLS
      000279 19               [11]  575 	add	hl,de
      00027A D1               [10]  576 	pop	de
                                    577 
      00027B 22 95 FF         [16]  578 putlf2:	ld	(vidptr),hl
      00027E 7D               [ 4]  579 	ld	a,l
      00027F D3 51            [11]  580 	out	(PORTADDRL),a
      000281 7C               [ 4]  581 	ld	a,h
      000282 D3 52            [11]  582 	out	(PORTADDRH),a
      000284 C9               [10]  583 	ret
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 13.
Hexadecimal [24-Bits]



                                    584 	
      000285 C3 AA 02         [10]  585 putlf1:	jp	scroll_crt
                                    586 
      000288 AF               [ 4]  587 putclr: xor	a
      000289 32 93 FF         [13]  588 	ld	(vidrow),a
      00028C 32 94 FF         [13]  589 	ld	(vidcol),a
      00028F 32 95 FF         [13]  590 	ld	(vidptr),a
      000292 32 96 FF         [13]  591 	ld	(vidptr+1),a
      000295 D3 51            [11]  592 	out	(PORTADDRL),a
      000297 D3 52            [11]  593 	out	(PORTADDRH),a
                                    594 	
      000299 21 C0 12         [10]  595 	ld	hl,#(VIDCOLS*VIDROWS)
      00029C AF               [ 4]  596 putclr1:xor	a
      00029D D3 50            [11]  597 	out	(PORTDATA),a
      00029F 2B               [ 6]  598 	dec	hl
      0002A0 7C               [ 4]  599 	ld	a,h
      0002A1 B5               [ 4]  600 	or	l
      0002A2 20 F8            [12]  601 	jr	nz,putclr1
      0002A4 AF               [ 4]  602 	xor	a
      0002A5 D3 51            [11]  603 	out	(PORTADDRL),a
      0002A7 D3 52            [11]  604 	out	(PORTADDRH),a
      0002A9 C9               [10]  605 	ret
                                    606 
                                    607 	;///////////////////////////////////////////////////////////////////////
      0002AA                        608 scroll_crt:
      0002AA C5               [11]  609 	push	bc
      0002AB D5               [11]  610 	push	de
                                    611 	
      0002AC 0E 3B            [ 7]  612 	ld	c,#(VIDROWS-1)
      0002AE 21 50 00         [10]  613 	ld	hl,#VIDCOLS
                                    614 
      0002B1                        615 scroll_screen:
                                    616 	;ld	b,#(VIDCOLS/VIDBUFSZ)
                                    617 
                                    618 ;scroll_1line:
      0002B1 C5               [11]  619 	push	bc
      0002B2 7D               [ 4]  620 	ld	a,l
      0002B3 D3 51            [11]  621 	out	(PORTADDRL),a
      0002B5 7C               [ 4]  622 	ld	a,h
      0002B6 D3 52            [11]  623 	out	(PORTADDRH),a
      0002B8 E5               [11]  624 	push	hl
      0002B9 21 97 FF         [10]  625 	ld	hl,#vidbuf
      0002BC 06 50            [ 7]  626 	ld	b,#VIDBUFSZ
      0002BE 0E 50            [ 7]  627 	ld	c,#PORTDATA
      0002C0 ED B2            [21]  628 	inir
      0002C2 E1               [10]  629 	pop	hl
                                    630 
      0002C3 E5               [11]  631 	push	hl
                                    632 	
      0002C4 11 B0 FF         [10]  633 	ld	de,#-VIDCOLS
      0002C7 19               [11]  634 	add	hl,de
      0002C8 7D               [ 4]  635 	ld	a,l
      0002C9 D3 51            [11]  636 	out	(PORTADDRL),a
      0002CB 7C               [ 4]  637 	ld	a,h
      0002CC D3 52            [11]  638 	out	(PORTADDRH),a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 14.
Hexadecimal [24-Bits]



      0002CE 21 97 FF         [10]  639 	ld	hl,#vidbuf
      0002D1 06 50            [ 7]  640 	ld	b,#VIDBUFSZ
                                    641 	;ld	c,#PORTDATA
      0002D3 ED B3            [21]  642 	otir
                                    643 	
      0002D5 E1               [10]  644 	pop	hl
      0002D6 11 50 00         [10]  645 	ld	de,#VIDCOLS
      0002D9 19               [11]  646 	add	hl,de
                                    647 
      0002DA C1               [10]  648 	pop	bc
                                    649 	;djnz	scroll_1line
                                    650 
      0002DB 0D               [ 4]  651 	dec	c
      0002DC 20 D3            [12]  652 	jr	nz,scroll_screen
                                    653 
      0002DE 21 70 12         [10]  654 	ld	hl,#((VIDROWS-1)*VIDCOLS)
      0002E1 7D               [ 4]  655 	ld	a,l
      0002E2 D3 51            [11]  656 	out	(PORTADDRL),a
      0002E4 7C               [ 4]  657 	ld	a,h
      0002E5 D3 52            [11]  658 	out	(PORTADDRH),a
      0002E7 AF               [ 4]  659 	xor	a
      0002E8 06 50            [ 7]  660 	ld	b,#VIDCOLS
                                    661 
      0002EA                        662 scroll3:
      0002EA D3 50            [11]  663 	out	(PORTDATA),a
      0002EC 10 FC            [13]  664 	djnz	scroll3
                                    665 
      0002EE 2A 95 FF         [16]  666 	ld	hl,(vidptr)
      0002F1 7D               [ 4]  667 	ld	a,l
      0002F2 D3 51            [11]  668 	out	(PORTADDRL),a
      0002F4 7C               [ 4]  669 	ld	a,h
      0002F5 D3 52            [11]  670 	out	(PORTADDRH),a
                                    671 
      0002F7 D1               [10]  672 	pop	de
      0002F8 C1               [10]  673 	pop	bc
      0002F9 C9               [10]  674 	ret
                                    675 
                                    676 	;///////////////////////////////////////////////////////////////////////
                                    677 	;////////////////////   PS/2 KEYBOARD FUNCTIONS   //////////////////////
                                    678 	;///////////////////////////////////////////////////////////////////////
                                    679 
      0002FA                        680 keypressed:
      0002FA 3A F3 FF         [13]  681 	ld	a,(lastkey)
      0002FD B7               [ 4]  682 	or	a
      0002FE C0               [11]  683 	ret	nz
      0002FF CD 1C 03         [17]  684 	call	_readkey
      000302 C8               [11]  685 	ret	z
      000303 32 F3 FF         [13]  686 	ld	(lastkey),a
      000306 B7               [ 4]  687 	or	a
      000307 C9               [10]  688 	ret
                                    689 
      000308 3A F3 FF         [13]  690 readkey:ld	a,(lastkey)
      00030B B7               [ 4]  691 	or	a
      00030C 28 08            [12]  692 	jr	z,readk1
      00030E F5               [11]  693 	push	af
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 15.
Hexadecimal [24-Bits]



      00030F AF               [ 4]  694 	xor	a
      000310 32 F3 FF         [13]  695 	ld	(lastkey),a
      000313 F1               [10]  696 	pop	af
      000314 B7               [ 4]  697 	or	a
      000315 C9               [10]  698 	ret
                                    699 
      000316 CD 1C 03         [17]  700 readk1:	call	_readkey
      000319 28 FB            [12]  701 	jr	z,readk1
      00031B C9               [10]  702 	ret
                                    703 
      00031C                        704 _readkey:
      00031C F3               [ 4]  705 	di
      00031D 3A EF FF         [13]  706 	ld	a,(bufkeyqty)
      000320 B7               [ 4]  707 	or	a
      000321 20 02            [12]  708 	jr	nz,keyt1
      000323 FB               [ 4]  709 	ei
      000324 C9               [10]  710 	ret
                                    711 
      000325                        712 keyt1:
      000325 3D               [ 4]  713 	dec	a
      000326 32 EF FF         [13]  714 	ld	(bufkeyqty),a
                                    715 
      000329 E5               [11]  716 	push	hl
      00032A C5               [11]  717 	push	bc
      00032B 3A F1 FF         [13]  718 	ld	a,(bufkeyget)
      00032E 4F               [ 4]  719 	ld	c,a
      00032F 06 00            [ 7]  720 	ld	b,#0
      000331 21 E7 FF         [10]  721 	ld	hl,#bufkey
      000334 09               [11]  722 	add	hl,bc
      000335 C1               [10]  723 	pop	bc
                                    724 
      000336 3C               [ 4]  725 	inc	a
      000337 FE 08            [ 7]  726 	cp	#BUFKEYSIZE
      000339 20 01            [12]  727 	jr	nz,keyt2
                                    728 
      00033B AF               [ 4]  729 	xor	a
                                    730 
      00033C                        731 keyt2:
      00033C 32 F1 FF         [13]  732 	ld	(bufkeyget),a
      00033F 7E               [ 7]  733 	ld	a,(hl)			; scan code here
      000340 E1               [10]  734 	pop	hl
      000341 FB               [ 4]  735 	ei
                                    736 
      000342 FE F0            [ 7]  737 	cp	#0xf0
      000344 20 09            [12]  738 	jr	nz,keyt6
                                    739 
      000346 E5               [11]  740 	push	hl
      000347 21 F2 FF         [10]  741 	ld	hl,#kflags
      00034A CB DE            [15]  742 	set	3,(hl)
      00034C E1               [10]  743 	pop	hl
      00034D AF               [ 4]  744 	xor	a
      00034E C9               [10]  745 	ret
                                    746 
      00034F                        747 keyt6:
      00034F C5               [11]  748 	push	bc
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 16.
Hexadecimal [24-Bits]



      000350 E5               [11]  749 	push	hl
                                    750 	
      000351 21 F2 FF         [10]  751 	ld	hl,#kflags
      000354 CB 5E            [12]  752 	bit	3,(hl)
      000356 28 1B            [12]  753 	jr	z,keyt3a		; No previous BREAK Code
                                    754 	
      000358 CB 9E            [15]  755 	res	3,(hl)			; Clear Break code flag
                                    756 	
      00035A FE 12            [ 7]  757 	cp	#0x12			; LShift	
      00035C 20 04            [12]  758 	jr	nz,keyt6a
      00035E CB 86            [15]  759 	res	0,(hl)
      000360 18 0E            [12]  760 	jr	keyt6c
                                    761 
      000362                        762 keyt6a:
      000362 FE 59            [ 7]  763 	cp	#0x59			; RShift	
      000364 20 04            [12]  764 	jr	nz,keyt6b
      000366 CB 8E            [15]  765 	res	1,(hl)
      000368 18 06            [12]  766 	jr	keyt6c
                                    767 
      00036A                        768 keyt6b:
      00036A FE 14            [ 7]  769 	cp	#0x14			; LCTRL	
      00036C 20 02            [12]  770 	jr	nz,keyt6c
      00036E CB A6            [15]  771 	res	4,(hl)
                                    772 
      000370                        773 keyt6c:
      000370 AF               [ 4]  774 	xor	a
      000371 18 5E            [12]  775 	jr	keyt4
                                    776 
      000373                        777 keyt3a:
      000373 FE 12            [ 7]  778 	cp	#0x12			; LShift	
      000375 20 04            [12]  779 	jr	nz,keyt3b
      000377 CB C6            [15]  780 	set	0,(hl)
      000379 18 56            [12]  781 	jr	keyt4
                                    782 
      00037B                        783 keyt3b:
      00037B FE 59            [ 7]  784 	cp	#0x59			; RShift	
      00037D 20 04            [12]  785 	jr	nz,keyt3c
      00037F CB CE            [15]  786 	set	1,(hl)
      000381 18 4E            [12]  787 	jr	keyt4
                                    788 
      000383                        789 keyt3c:
      000383 FE 58            [ 7]  790 	cp	#0x58			; Caps	
      000385 20 07            [12]  791 	jr	nz,keyt3d
      000387 7E               [ 7]  792 	ld	a,(hl)
      000388 EE 04            [ 7]  793 	xor	#0x04
      00038A 77               [ 7]  794 	ld	(hl),a
      00038B AF               [ 4]  795 	xor	a
      00038C 18 43            [12]  796 	jr	keyt4
                                    797 
      00038E                        798 keyt3d:
      00038E FE 14            [ 7]  799 	cp 	#0x14			; LCTRL
      000390 20 04            [12]  800 	jr	nz,keyt3e
      000392 CB E6            [15]  801 	set	4,(HL)
      000394 18 3B            [12]  802 	jr	keyt4
                                    803 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 17.
Hexadecimal [24-Bits]



      000396                        804 keyt3e:
      000396 21 D4 03         [10]  805 	ld	hl,#tab_xlat
      000399 4F               [ 4]  806 	ld	c,a
                                    807 
      00039A                        808 keyt3:
      00039A 7E               [ 7]  809 	ld	a,(hl)
      00039B B7               [ 4]  810 	or	a
      00039C 28 33            [12]  811 	jr	z,keyt4			; end of table
      00039E B9               [ 4]  812 	cp	c
      00039F 28 06            [12]  813 	jr	z,keyt5			; found
      0003A1 23               [ 6]  814 	inc	hl
      0003A2 23               [ 6]  815 	inc	hl
      0003A3 23               [ 6]  816 	inc	hl
      0003A4 23               [ 6]  817 	inc	hl
      0003A5 18 F3            [12]  818 	jr	keyt3
                                    819 
      0003A7                        820 keyt5:
      0003A7 23               [ 6]  821 	inc	hl
      0003A8 01 F2 FF         [10]  822 	ld	bc,#kflags
      0003AB 0A               [ 7]  823 	ld	a,(bc)
      0003AC 4F               [ 4]  824 	ld	c,a
      0003AD E6 03            [ 7]  825 	and	#0x03			; LShift | RShift
      0003AF 79               [ 4]  826 	ld	a,c
      0003B0 28 03            [12]  827 	jr	z,keyt5a
      0003B2 23               [ 6]  828 	inc	hl
      0003B3 18 07            [12]  829 	jr	keyt5b
                                    830 
      0003B5                        831 keyt5a:
      0003B5 79               [ 4]  832 	ld	a,c
      0003B6 E6 04            [ 7]  833 	and	#0x04			; Caps
      0003B8 28 02            [12]  834 	jr	z,keyt5b
      0003BA 23               [ 6]  835 	inc	hl
      0003BB 23               [ 6]  836 	inc	hl
                                    837 
      0003BC                        838 keyt5b:
      0003BC CB 61            [ 8]  839 	bit	4,c			; LCTRL
      0003BE 7E               [ 7]  840 	ld	a,(hl)
      0003BF 28 0F            [12]  841 	jr	z,keyt4a
                                    842 
      0003C1 CB AF            [ 8]  843 	res	5,a
      0003C3 FE 41            [ 7]  844 	cp	#'A'
      0003C5 38 08            [12]  845 	jr	c,keyt4b
      0003C7 FE 5B            [ 7]  846 	cp	#'Z'+1
      0003C9 30 04            [12]  847 	jr	nc,keyt4b
      0003CB D6 40            [ 7]  848 	sub	#0x40
      0003CD 18 01            [12]  849 	jr	keyt4a
                                    850 
      0003CF                        851 keyt4b:	
      0003CF AF               [ 4]  852 	xor	a
                                    853 
      0003D0                        854 keyt4a:
      0003D0 B7               [ 4]  855 	or	a			; not 0 when there's a valid symbol
                                    856 
      0003D1                        857 keyt4:
      0003D1 E1               [10]  858 	pop	hl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 18.
Hexadecimal [24-Bits]



      0003D2 C1               [10]  859 	pop	bc
      0003D3 C9               [10]  860 	ret		
                                    861 
                                    862 	;///////////////////////////////////////////////////////////////////////
                                    863 
      0003D4                        864 tab_xlat:
                                    865 	; US QWERTY compatible symbols
                                    866 	;	SCAN NORM SHIFT CAPS
      0003D4 1C 61 41 41            867 	.byte	0x1c, 'a', 'A', 'A'
      0003D8 32 62 42 42            868 	.byte	0x32, 'b', 'B', 'B'
      0003DC 21 63 43 43            869 	.byte	0x21, 'c', 'C', 'C'
      0003E0 23 64 44 44            870 	.byte	0x23, 'd', 'D', 'D'
      0003E4 24 65 45 45            871 	.byte	0x24, 'e', 'E', 'E'
      0003E8 2B 66 46 46            872 	.byte	0x2b, 'f', 'F', 'F'
      0003EC 34 67 47 47            873 	.byte	0x34, 'g', 'G', 'G'
      0003F0 33 68 48 48            874 	.byte	0x33, 'h', 'H', 'H'
      0003F4 43 69 49 49            875 	.byte	0x43, 'i', 'I', 'I'
      0003F8 3B 6A 4A 4A            876 	.byte	0x3b, 'j', 'J', 'J'
      0003FC 42 6B 4B 4B            877 	.byte	0x42, 'k', 'K', 'K'
      000400 4B 6C 4C 4C            878 	.byte	0x4b, 'l', 'L', 'L'
      000404 3A 6D 4D 4D            879 	.byte	0x3a, 'm', 'M', 'M'
      000408 31 6E 4E 4E            880 	.byte	0x31, 'n', 'N', 'N'
      00040C 44 6F 4F 4F            881 	.byte	0x44, 'o', 'O', 'O'
      000410 4D 70 50 50            882 	.byte	0x4D, 'p', 'P', 'P'
      000414 15 71 51 51            883 	.byte	0x15, 'q', 'Q', 'Q'
      000418 2D 72 52 52            884 	.byte	0x2d, 'r', 'R', 'R'
      00041C 1B 73 53 53            885 	.byte	0x1b, 's', 'S', 'S'
      000420 2C 74 54 54            886 	.byte	0x2c, 't', 'T', 'T'
      000424 3C 75 55 55            887 	.byte	0x3c, 'u', 'U', 'U'
      000428 2A 76 56 56            888 	.byte	0x2a, 'v', 'V', 'V'
      00042C 1D 77 57 57            889 	.byte	0x1d, 'w', 'W', 'W'
      000430 22 78 58 58            890 	.byte	0x22, 'x', 'X', 'X'
      000434 35 79 59 59            891 	.byte	0x35, 'y', 'Y', 'Y'
      000438 1A 7A 5A 5A            892 	.byte	0x1a, 'z', 'Z', 'Z'
      00043C 45 30 29 30            893 	.byte	0x45, '0', ')', '0'
      000440 16 31 21 31            894 	.byte	0x16, '1', '!', '1'
      000444 1E 32 40 32            895 	.byte	0x1e, '2', '@', '2'
      000448 26 33 23 33            896 	.byte	0x26, '3', '#', '3'
      00044C 25 34 24 34            897 	.byte	0x25, '4', '$', '4'
      000450 2E 35 25 35            898 	.byte	0x2e, '5', '%', '5'
      000454 3D 37 26 37            899 	.byte	0x3d, '7', '&', '7'
      000458 3E 38 2A 38            900 	.byte	0x3e, '8', '*', '8'
      00045C 3E 38 2A 38            901 	.byte	0x3e, '8', '*', '8'
      000460 46 39 28 39            902 	.byte	0x46, '9', '(', '9'
      000464 4E 2D 5F 2D            903 	.byte	0x4e, '-', '_', '-'
      000468 55 3D 2B 3D            904 	.byte	0x55, '=', '+', '='
      00046C 66 08 08 08            905 	.byte	0x66, 0x08,0x08,0x08
      000470 29 20 20 20            906 	.byte	0x29, ' ', ' ', ' '
      000474 0D 09 09 09            907 	.byte	0x0d, 0x09,0x09,0x09
      000478 5A 0D 0D 0D            908 	.byte	0x5a, 0x0d,0x0d,0x0d
      00047C 76 1B 1B 1B            909 	.byte	0x76, 0x1b,0x1b,0x1b
      000480 0E 27 22 27            910 	.byte	0x0e, 0x27,'"', 0x27
                                    911 	; Brazilian ABNT2 codes
                                    912 	;	SCAN NORM SHIFT CAPS
      000484 36 36 22 36            913 	.byte	0x36, '6', '"', '6'
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 19.
Hexadecimal [24-Bits]



      000488 61 5C 7C 5C            914 	.byte	0x61, '\', '|', '\'
      00048C 41 2C 3C 2C            915 	.byte	0x41, ',', '<', ','
      000490 49 2E 3E 2E            916 	.byte	0x49, '.', '>', '.'
      000494 54 27 60 27            917 	.byte	0x54, 0x27, '`', 0x27 
      000498 5B 5B 7B 5B            918 	.byte	0x5b, '[', '{', '['
      00049C 52 7E 5E 7E            919 	.byte	0x52, '~', '^', '~'
      0004A0 5D 5D 7D 5D            920 	.byte	0x5d, ']', '}', ']'
      0004A4 4A 3B 3A 3B            921 	.byte	0x4a, ';', ':', ';'
      0004A8 51 2F 3F 2F            922 	.byte	0x51, '/', '?', '/'
      0004AC 00                     923 	.byte	0x00
                                    924 
                                    925 ;===============================================================================
                                    926 
                                    927 
                                    928 	;///////////////////////////////////////////////////////////////////////
      0004AD                        929 gsinit:
      0004AD 01 00 00         [10]  930 	ld	bc, #l__INITIALIZER
      0004B0 78               [ 4]  931 	ld	a, b
      0004B1 B1               [ 4]  932 	or	a, c
      0004B2 28 08            [12]  933 	jr	Z, gsinit_next
      0004B4 11 00 00         [10]  934 	ld	de, #s__INITIALIZED
      0004B7 21 00 00         [10]  935 	ld	hl, #s__INITIALIZER
      0004BA ED B0            [21]  936 	ldir
      0004BC                        937 gsinit_next:
      0004BC C9               [10]  938         ret
                                    939 
                                    940 	;; Ordering of segments for the linker.
                                    941 	.area	_HOME
                                    942 	.area	_CODE
                                    943 	.area	_INITIALIZER
                                    944 	.area   _GSINIT
                                    945 	.area   _GSFINAL
                                    946         .area   _MAIN
                                    947 	.area	_DATA
                                    948 	.area	_INITIALIZED
                                    949 	.area	_BSEG
                                    950 	.area   _BSS
                                    951 	.area   _HEAP
                                    952 
                                    953 	;.area   _CODE
                                    954 
                                    955 	;.area   _GSFINAL
                                    956 
