ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 1.
Hexadecimal [24-Bits]



                                      1 ;//////////////////////////////////////////////////////////////////////////////;
                                      2 ; Project:                                                                     ;
                                      3 ;    PICALC-Z80-KRAFT80                                                        ;
                                      4 ;                                                                              ;
                                      5 ; Description:                                                                 ;
                                      6 ;    A calculator that yields an arbitrary number of digits of the number PI.  ;
                                      7 ;                                                                              ;
                                      8 ; Targets:                                                                     ;
                                      9 ;    1. The modified WR Kits' Z80 Alpha computer (AKA Z80 Alpha Plus by ARM    ;
                                     10 ;       Coder).                                                                ;
                                     11 ;    2. Kraft 80 Computer by ARM Coder (that's a derivative from the project   ;
                                     12 ;       above).                                                                ;
                                     13 ;                                                                              ;
                                     14 ;    Details of memory allocation and stack positioning must be adjusted for   ;
                                     15 ;    the specifics of other targets, if any. In addition, INT 08h is used as a ;
                                     16 ;    function call to print character over TTY (A = character), which          ;
                                     17 ;    implementation has to be adjusted to the target.                          ;
                                     18 ;                                                                              ;
                                     19 ; Compiler:                                                                    ;
                                     20 ;    Tasm + DosBox                                                             ;
                                     21 ;                                                                              ;
                                     22 ;    Other compilers/assemblers may require minor changes in the source code.  ;
                                     23 ;                                                                              ;
                                     24 ; Usage:                                                                       ;
                                     25 ;    The desired amount of PI digits is defined in the macro NUM_DECS. Default ;
                                     26 ;    value is 100. Note that incrementing this value will increase RAM usage   ;
                                     27 ;    proportionally, and the needed CPU cycles quadratically. Don't change the ;
                                     28 ;    other algorithm constants unless you really know what you are doing.      ;
                                     29 ;                                                                              ;
                                     30 ;    The algorithm was validated for 1,000 digits of PI, all of them checked   ;
                                     31 ;    against the generally known published digits. For an actual Z80, yielding ;
                                     32 ;    this number of digits may prove to be a daunting task, especially because ;
                                     33 ;    of the gigantic number of CPU cycles needed (RAM is a lesser problem in   ;
                                     34 ;    this regard). 100 digits is way more practical amount, unless you have A  ;
                                     35 ;    LOT of time to spare.                                                     ;
                                     36 ;                                                                              ;
                                     37 ;    The main loop iteracts as many times as needed to calculate all the       ;
                                     38 ;    decimal places requested (the number of iterations / number of digits have;
                                     39 ;    a ratio close to 0.9). With each iteration the message 'TOTAL:' is printed;
                                     40 ;    along the PI approximation calculated so far.                             ;
                                     41 ;                                                                              ;
                                     42 ; Version & Date:                                                              ;
                                     43 ;    1.0 - 2025-MAY-01                                                         ;
                                     44 ;                                                                              ;
                                     45 ; Author:                                                                      ;
                                     46 ;    Milton Maldonado Jr (ARM_Coder)                                           ;
                                     47 ;                                                                              ;
                                     48 ; License:                                                                     ;
                                     49 ;    GPL V2                                                                    ;
                                     50 ;                                                                              ;
                                     51 ; Disclaimer:                                                                  ;
                                     52 ;    This code is supplied 'as is' with no warranty against bugs. It was tested;
                                     53 ;    on a Z80 simulator that *I* wrote (haha), so it was not tested against any;
                                     54 ;    actual, validated target.                                                 ;
                                     55 ;                                                                              ;
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 2.
Hexadecimal [24-Bits]



                                     56 ; Note:                                                                        ;
                                     57 ;    Along the ASM source, you will see some commented 'C' statemens. The      ;
                                     58 ;    project was initially built and tested in C, and then hand-translated     ;
                                     59 ;    to Z80 ASM.                                                               ;
                                     60 ;                                                                              ;
                                     61 ; Funny note:                                                                  ;
                                     62 ;    This project implements the Bailey-Borwein-Plouffe method of calculating  ;
                                     63 ;    PI. This method is much, much faster that the classic Leibniz series.     ;
                                     64 ;    The funny thing is that the method was discovered (invented?) in 1995,    ;
                                     65 ;    when the Z80 had already passed its heyday and was fading into a niche,   ;
                                     66 ;	retro platform.                                                           ;
                                     67 ;//////////////////////////////////////////////////////////////////////////////;
                                     68 
                                     69 ; Hardware constants
                           000000    70 PORTLEDS	.equ	0x00
                           000000    71 PORTBUTTONS	.equ	0x00
                           000010    72 PORTDISP	.equ	0x10
                                     73 
                           000000    74 ROMBASE         .equ 0
                           002000    75 ROMSZ           .equ 0x2000
                           004000    76 RAMBASE         .equ 0x4000
                           00C000    77 RAMSZ           .equ 0xC000
                                     78 
                                     79 ; Algorithm constants
                           00001B    80 NUM_DECS        .equ 27
                           000018    81 NUM_IT          .equ ((NUM_DECS*9)/10)
                           00005E    82 NBITS_FR        .equ (3*NUM_DECS + (NUM_DECS >> 1))
                           000010    83 NBITS_INT       .equ 16
                           000060    84 NBITS_FRAC      .equ 8*(1 + (NBITS_FR >> 3)) ; The number of bits should be at least 3.33x (1 / log(2)) the number of decimal places, plus a small cushion.
                           000002    85 NBYTES_INT      .equ NBITS_INT >> 3
                           000070    86 NBITS           .equ NBITS_INT+NBITS_FRAC
                           00000E    87 NBYTES          .equ NBITS>>3
                           00000D    88 NBYTES1         .equ (NBYTES-1)
                                     89 
                                     90 	.area	_HEADER (ABS)
                                     91 
      000000                         92 	.org	ROMBASE	; Expected to be 0x00. Other values will clash with the
                                     93 			; interrupt handlers below.
                                     94 
      000000 C3 68 00         [10]   95 	jp	start
                                     96 
      000008                         97 	.org	0x0008
      000008 C5               [11]   98 	push	bc
      000009 CD 98 08         [17]   99 	call	lcd_write
      00000C C1               [10]  100 	pop	bc
      00000D C9               [10]  101 	ret
                                    102 
      000038                        103 	.org	0x0038      ; HW Interrupt IM 1.
      000038 ED 4D            [14]  104 	reti
                                    105 
      000066                        106 	.org	0x0066      ; NMI
      000066 ED 45            [14]  107 	retn
                                    108 
      000068                        109 start:
                                    110 	;ld	hl,RAMBASE+RAMSZ-1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 3.
Hexadecimal [24-Bits]



                                    111 	;xor	a
                                    112 	;ld	(hl),a
      000068                        113 loopled:
                                    114 	;in	a,(PORTX)
                                    115 	;cpl
                                    116 	;or	a
                                    117 	;jr	z,loopled
                                    118 	;ld	a,(hl)
                                    119 	;out	(PORTA),a
                                    120 	;inc	a
                                    121 	;ld	(hl),a
                                    122 	;jr	loopled
                                    123 	
      000068 31 00 00         [10]  124 	ld	sp,#(RAMBASE + RAMSZ)
      00006B CD 7A 08         [17]  125 	call	_main
      00006E 76               [ 4]  126 	halt
                                    127 
                                    128 ;///////////////////////////////////////////////////////////////////////////////
                                    129 ;   print_crlf
                                    130 ;   void print_crlf(void);
                                    131 ;   Parameters: Nothing
                                    132 ;   Returns: Nothing
                                    133 ;   Affects: HL
      00006F                        134 print_crlf:
                                    135 
      00006F 3E 0D            [ 7]  136 	ld	a,#0x0d
      000071 CF               [11]  137 	rst	#0x08
      000072 3E 0A            [ 7]  138 	ld	a,#0x0a
      000074 CF               [11]  139 	rst	#0x08
      000075 C9               [10]  140 	ret
                                    141 
                                    142 ;///////////////////////////////////////////////////////////////////////////////
                                    143 ;   zero_reg
                                    144 ;   void zero_reg(uint8_t *reg);
                                    145 ;   Parameters:
                                    146 ;     HL: reg
                                    147 ;   Returns: Nothing
                                    148 ;   Affects: BC DE HL AF
      000076                        149 zero_reg:
                                    150 
                                    151 	;    memset(reg,0,NBYTES);
      000076 01 0D 00         [10]  152 	ld	bc,#(NBYTES-1)
      000079 AF               [ 4]  153 	xor	a
      00007A 77               [ 7]  154 	ld	(hl),a
      00007B 54               [ 4]  155 	ld	d,h
      00007C 5D               [ 4]  156 	ld	e,l
      00007D 13               [ 6]  157 	inc	de
      00007E ED B0            [21]  158 	ldir
      000080 C9               [10]  159 	ret
                                    160 
                                    161 ;///////////////////////////////////////////////////////////////////////////////
                                    162 ;   set_bit_reg
                                    163 ;   void set_bit_reg(uint8_t *reg, int place);
                                    164 ;   Parameters:
                                    165 ;     HL: reg
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 4.
Hexadecimal [24-Bits]



                                    166 ;     BC: place
                                    167 ;   Returns: Nothing
                                    168 ;   Affects: BC DE HL AF
      000081                        169 set_bit_reg:
                                    170 
                                    171     ;   int byte = NBYTES1 - (place >> 3);
      000081 E5               [11]  172 	push	hl
      000082 21 0D 00         [10]  173 	ld	hl,#NBYTES1
                                    174 
      000085                        175 set_bit_reg0:
                                    176 
      000085 50               [ 4]  177 	ld	d,b
      000086 59               [ 4]  178 	ld	e,c
      000087 CB 3A            [ 8]  179 	srl	d
      000089 CB 1B            [ 8]  180 	rr	e
      00008B CB 3A            [ 8]  181 	srl	d
      00008D CB 1B            [ 8]  182 	rr	e
      00008F CB 3A            [ 8]  183 	srl	d
      000091 CB 1B            [ 8]  184 	rr	e
      000093 37               [ 4]  185 	scf
      000094 3F               [ 4]  186 	ccf
      000095 ED 52            [15]  187 	sbc	hl,de
      000097 EB               [ 4]  188 	ex	de,hl    ;DE: byte
      000098 E1               [10]  189 	pop	hl
                                    190 
                                    191     ;   int bits = place & 0x07;
      000099 79               [ 4]  192 	ld	a,c
      00009A E6 07            [ 7]  193 	and	#0x07    ;A: bits
                                    194 
                                    195     ;   reg[byte] |= 1<<bits;
      00009C 19               [11]  196 	add	hl,de
                                    197 
      00009D 06 01            [ 7]  198 	ld	b,#1
      00009F B7               [ 4]  199 	or	a
      0000A0 28 05            [12]  200 	jr	z,set_bit_reg2
                                    201 
      0000A2                        202 set_bit_reg1:
                                    203 
      0000A2 CB 20            [ 8]  204 	sla	b
      0000A4 3D               [ 4]  205 	dec	a
      0000A5 20 FB            [12]  206 	jr	nz,set_bit_reg1
                                    207 
      0000A7                        208 set_bit_reg2:
                                    209 
      0000A7 7E               [ 7]  210 	ld	a,(hl)
      0000A8 B0               [ 4]  211 	or	b
      0000A9 77               [ 7]  212 	ld	(hl),a
      0000AA C9               [10]  213 	ret
                                    214 
                                    215 ;///////////////////////////////////////////////////////////////////////////////
                                    216 ;   set_bit_reg_int
                                    217 ;   void set_bit_reg_int(uint8_t *reg, int place);
                                    218 ;   Parameters:
                                    219 ;     HL: reg
                                    220 ;     BC: place
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 5.
Hexadecimal [24-Bits]



                                    221 ;   Returns: Nothing
                                    222 ;   Affects: BC DE HL AF
      0000AB                        223 set_bit_reg_int:
                                    224 
                                    225     ;   int byte = NBYTES_INT - 1 - (place >> 3);
      0000AB E5               [11]  226 	push	hl
      0000AC 21 01 00         [10]  227 	ld	hl,#(NBYTES_INT-1)
      0000AF 18 D4            [12]  228 	jr	set_bit_reg0
                                    229 
                                    230 ;///////////////////////////////////////////////////////////////////////////////
                                    231 ;   print_reg
                                    232 ;   void print_reg(uint8_t *reg);
                                    233 ;   NÃ£o portada
                                    234 
                                    235 ;///////////////////////////////////////////////////////////////////////////////
                                    236 ;   add_reg2_to_reg1
                                    237 ;   void add_reg2_to_reg1(uint8_t *reg1, const uint8_t *reg2);
                                    238 ;   Parameters:
                                    239 ;     HL: reg2
                                    240 ;     DE: reg1
                                    241 ;   Returns: Nothing
                                    242 ;   Affects: BC DE HL AF BC' DE' HL' AF'
      0000B1                        243 add_reg2_to_reg1:
                                    244 
                                    245     ;   uint16_t cy = 0;
                                    246     ;   int i;
                                    247     ;   for (i = NBYTES1; i >= 0; i--){
                                    248     ;       uint16_t sum = (uint16_t)reg1[i] + (uint16_t)reg2[i] + cy;
                                    249     ;       if (sum & 0x100)
                                    250     ;           cy = 1;
                                    251     ;       else
                                    252     ;           cy = 0;
                                    253     ;       reg1[i] = sum & 0xff;
                                    254     ;   }
                                    255 
      0000B1 01 0D 00         [10]  256 	ld	bc,#NBYTES1
      0000B4 09               [11]  257 	add	hl,bc
      0000B5 EB               [ 4]  258 	ex	de,hl
      0000B6 09               [11]  259 	add	hl,bc
      0000B7 EB               [ 4]  260 	ex	de,hl
      0000B8 D9               [ 4]  261 	exx
      0000B9 01 0D 00         [10]  262 	ld	bc,#NBYTES1
      0000BC 03               [ 6]  263 	inc	bc
      0000BD D9               [ 4]  264 	exx
      0000BE 97               [ 4]  265 	sub	a   ;zero Carry Flag
                                    266 
      0000BF                        267 add_reg2_to_reg1_0:
                                    268 
      0000BF 46               [ 7]  269 	ld	b,(hl)
      0000C0 1A               [ 7]  270 	ld	a,(de)
      0000C1 88               [ 4]  271 	adc	a,b
      0000C2 12               [ 7]  272 	ld	(de),a
                                    273 
      0000C3 2B               [ 6]  274 	dec	hl
      0000C4 1B               [ 6]  275 	dec	de
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 6.
Hexadecimal [24-Bits]



                                    276 
      0000C5 D9               [ 4]  277 	exx                         ; Save HL & DE, restores counter in BC
      0000C6 08               [ 4]  278 	ex	af,af'                   ; Save CY
      0000C7 0B               [ 6]  279 	dec	bc
      0000C8 78               [ 4]  280 	ld	a,b
      0000C9 B1               [ 4]  281 	or	c
      0000CA C8               [11]  282 	ret	z                       ; End loop, bye
      0000CB 08               [ 4]  283 	ex	af,af'                   ; Restore CY
      0000CC D9               [ 4]  284 	exx                         ; Save counter in BC, restores HL & DE
      0000CD 18 F0            [12]  285 	jr	add_reg2_to_reg1_0
                                    286 
                                    287 ;///////////////////////////////////////////////////////////////////////////////
                                    288 ;   add_reg_to_acc
                                    289 ;   void add_reg_to_acc(const uint8_t *reg);
                                    290 ;   Parameters:
                                    291 ;     HL: reg
                                    292 ;   Returns: Nothing
                                    293 ;   Affects: BC DE HL AF BC' DE' HL' AF'
      0000CF                        294 add_reg_to_acc:
                                    295 
      0000CF 11 00 40         [10]  296 	ld	de,#acc
      0000D2 18 DD            [12]  297 	jr	add_reg2_to_reg1
                                    298 
                                    299 ;///////////////////////////////////////////////////////////////////////////////
                                    300 ;   inc_reg_int8
                                    301 ;   void inc_reg_int8(uint8_t *reg, uint8_t byteval);
                                    302 ;   Parameters:
                                    303 ;     DE: reg
                                    304 ;     A:  byteval
                                    305 ;   Returns: Nothing
                                    306 ;   Affects: BC DE HL AF BC' DE' HL' AF'
      0000D4                        307 inc_reg_int8:
                                    308 
                                    309     ;    uint16_t cy = byteval;
                                    310     ;    int i;
                                    311     ;    for (i = NBYTES_INT - 1; i >= 0; i--){
                                    312     ;        uint16_t sum =(uint16_t)reg[i] + cy;
                                    313     ;        reg[i] = sum & 0xff;
                                    314     ;        if (!(sum & 0x100))
                                    315     ;        	return;
                                    316     ;        cy = 1;
                                    317     ;    }
                                    318 
      0000D4 01 02 00         [10]  319 	ld	bc,#NBYTES_INT
      0000D7 EB               [ 4]  320 	ex	de,hl
      0000D8 09               [11]  321 	add	hl,bc
      0000D9 2B               [ 6]  322 	dec	hl
      0000DA 5F               [ 4]  323 	ld	e,a
                                    324 
      0000DB                        325 inc_reg_int8_0:
                                    326 
      0000DB 7E               [ 7]  327 	ld	a,(hl)
      0000DC 83               [ 4]  328 	add	a,e
      0000DD 77               [ 7]  329 	ld	(hl),a
                                    330 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 7.
Hexadecimal [24-Bits]



      0000DE 1E 00            [ 7]  331 	ld	e,#0
      0000E0 30 01            [12]  332 	jr	nc, inc_reg_int8_1
      0000E2 1C               [ 4]  333 	inc	e       ; Here E propagates the carry for the sums.
                                    334 
      0000E3                        335 inc_reg_int8_1:
                                    336 
      0000E3 0B               [ 6]  337 	dec	bc
      0000E4 78               [ 4]  338 	ld	a,b
      0000E5 B1               [ 4]  339 	or	c
      0000E6 C8               [11]  340 	ret	z                       ; End loop, bye
                                    341 
      0000E7 2B               [ 6]  342 	dec	hl
      0000E8 18 F1            [12]  343 	jr	inc_reg_int8_0
                                    344 
                                    345 ;///////////////////////////////////////////////////////////////////////////////
                                    346 ;   load_reg_int
                                    347 ;   void load_reg_int(uint8_t *reg, int val);
                                    348 ;   Parameters:
                                    349 ;     DE: reg
                                    350 ;     HL: val
                                    351 ;   Returns: Nothing
                                    352 ;   Affects: BC DE HL AF BC' DE' HL' AF'
      0000EA                        353 load_reg_int:
                                    354 
                                    355 ;    for (int i = NBYTES_INT - 1; i >= 0; i--){
                                    356 ;        reg[i] = val & 0xff;
                                    357 ;        val >>= 8;
                                    358 ;    }
      0000EA EB               [ 4]  359 	ex	de,hl
      0000EB 01 02 00         [10]  360 	ld	bc,#NBYTES_INT
      0000EE 09               [11]  361 	add	hl,bc
      0000EF 2B               [ 6]  362 	dec	hl
      0000F0 06 02            [ 7]  363 	ld	b,#NBYTES_INT
      0000F2 7B               [ 4]  364 	ld	a,e
      0000F3 77               [ 7]  365 	ld	(hl),a
      0000F4 2B               [ 6]  366 	dec	hl
      0000F5 7A               [ 4]  367 	ld	a,d
      0000F6 77               [ 7]  368 	ld	(hl),a
      0000F7 05               [ 4]  369 	dec	b
      0000F8 05               [ 4]  370 	dec	b
      0000F9 78               [ 4]  371 	ld	a,b
      0000FA B7               [ 4]  372 	or	a
      0000FB C8               [11]  373 	ret	z
      0000FC 2B               [ 6]  374 	dec	hl
      0000FD AF               [ 4]  375 	xor	a
      0000FE                        376 load_reg_int_0:
      0000FE 77               [ 7]  377 	ld	(hl),a
      0000FF 2B               [ 6]  378 	dec	hl
      000100 10 FC            [13]  379 	djnz	load_reg_int_0
      000102 C9               [10]  380 	ret
                                    381 
                                    382 ;///////////////////////////////////////////////////////////////////////////////
                                    383 ;   sub_reg2_from_reg1
                                    384 ;   void sub_reg2_from_reg1(uint8_t *reg1, const uint8_t *reg2);
                                    385 ;   Parameters:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 8.
Hexadecimal [24-Bits]



                                    386 ;     DE: reg1
                                    387 ;     HL: reg2
                                    388 ;   Returns: Nothing
                                    389 ;   Affects: BC DE HL AF BC' DE' HL' AF'
      000103                        390 sub_reg2_from_reg1:
                                    391 
                                    392 ;    uint16_t cy = 0;
                                    393 ;    int i;
                                    394 ;    for (i = NBYTES1; i >= 0; i--){
                                    395 ;        uint16_t diff = (uint16_t)reg1[i] - (uint16_t)reg2[i] - cy;
                                    396 ;        if (diff & 0x8000)
                                    397 ;            cy = 1;
                                    398 ;        else
                                    399 ;            cy = 0;
                                    400 ;        reg1[i] = diff & 0xff;
                                    401 ;    }
                                    402 
      000103 01 0D 00         [10]  403 	ld	bc,#NBYTES1
      000106 09               [11]  404 	add	hl,bc
      000107 EB               [ 4]  405 	ex	de,hl
      000108 09               [11]  406 	add	hl,bc
      000109 EB               [ 4]  407 	ex	de,hl
      00010A D9               [ 4]  408 	exx
      00010B 01 0D 00         [10]  409 	ld	bc,#NBYTES1
      00010E 03               [ 6]  410 	inc	bc
      00010F D9               [ 4]  411 	exx
      000110 97               [ 4]  412 	sub	a   ;zera CY
                                    413 
      000111                        414 sub_reg2_to_reg1_0:
                                    415 
      000111 46               [ 7]  416 	ld	b,(hl)
      000112 1A               [ 7]  417 	ld	a,(de)
      000113 98               [ 4]  418 	sbc	a,b
      000114 12               [ 7]  419 	ld	(de),a
                                    420 
      000115 2B               [ 6]  421 	dec	hl
      000116 1B               [ 6]  422 	dec	de
                                    423 
      000117 D9               [ 4]  424 	exx                         ; Save HL & DE, restores counter in BC
      000118 08               [ 4]  425 	ex	af,af'                   ; Save CY
      000119 0B               [ 6]  426 	dec	bc
      00011A 78               [ 4]  427 	ld	a,b
      00011B B1               [ 4]  428 	or	c
      00011C C8               [11]  429 	ret	z                       ; End loop, bye
      00011D 08               [ 4]  430 	ex	af,af'                   ; Restore CY
      00011E D9               [ 4]  431 	exx                         ; Save counter in BC, restore HL & DE
      00011F 18 F0            [12]  432 	jr	sub_reg2_to_reg1_0
                                    433 
                                    434 ;///////////////////////////////////////////////////////////////////////////////
                                    435 ;   sub_reg_from_acc
                                    436 ;   void sub_reg_from_acc(const uint8_t *reg);
                                    437 ;   Parameters:
                                    438 ;     HL: reg
                                    439 ;   Returns: Nothing
                                    440 ;   Affects: BC DE HL AF BC' DE' HL' AF'
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 9.
Hexadecimal [24-Bits]



      000121                        441 sub_reg_from_acc:
                                    442 
      000121 11 00 40         [10]  443 	ld	de,#acc
      000124 CD 03 01         [17]  444 	call	sub_reg2_from_reg1
      000127 C9               [10]  445 	ret
                                    446 
                                    447 ;///////////////////////////////////////////////////////////////////////////////
                                    448 ;   shl_reg
                                    449 ;   void shl_reg(uint8_t *reg, int places)
                                    450 ;   Parameters:
                                    451 ;     DE: reg
                                    452 ;     BC: places
                                    453 ;   Returns: Nothing
                                    454 ;   Affects: BC DE HL AF
      000128                        455 shl_reg:
                                    456 
      000128 DD E5            [15]  457 	push	ix
      00012A DD 21 F8 FF      [14]  458 	ld	ix,#0xFFF8    ; Allocates 8 bytes
      00012E DD 39            [15]  459 	add	ix,sp
      000130 DD F9            [10]  460 	ld	sp,ix
                                    461 
      000132 DD 73 00         [19]  462 	ld	0(ix),e     ;IX+0, IX+1 = 'reg'
      000135 DD 72 01         [19]  463 	ld	1(ix),d
                                    464 
                                    465 ;    if (places > NBITS)
                                    466 ;        places = NBITS;
      000138 3E 00            [ 7]  467 	ld	a,#(NBITS >> 8)
      00013A 90               [ 4]  468 	sub	b
      00013B 38 07            [12]  469 	jr	c,shl_reg_0
      00013D 20 08            [12]  470 	jr	nz,shl_reg_1
                                    471 
      00013F 3E 70            [ 7]  472 	ld	a,#(NBITS & 255)
      000141 91               [ 4]  473 	sub	c
      000142 30 03            [12]  474 	jr	nc, shl_reg_1
                                    475 
      000144                        476 shl_reg_0:
                                    477 
      000144 01 70 00         [10]  478 	ld	bc,#NBITS
                                    479 
      000147                        480 shl_reg_1:
                                    481 
                                    482 ;    int bytes = places >> 3;
                                    483 ;    int bits = places & 0x07;
      000147 79               [ 4]  484 	ld	a,c
      000148 E6 07            [ 7]  485 	and	#0x07
      00014A DD 77 02         [19]  486 	ld	2(ix),a     ; IX+2 = 'bits'
      00014D CB 38            [ 8]  487 	srl	b
      00014F CB 19            [ 8]  488 	rr	c
      000151 CB 38            [ 8]  489 	srl	b
      000153 CB 19            [ 8]  490 	rr	c
      000155 CB 38            [ 8]  491 	srl	b
      000157 CB 19            [ 8]  492 	rr	c            ; BC = 'bytes'
                                    493 
                                    494 ;    int leftbytes = NBYTES - bytes;
      000159 21 0E 00         [10]  495 	ld	hl,#NBYTES
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 10.
Hexadecimal [24-Bits]



      00015C AF               [ 4]  496 	xor	a
      00015D ED 42            [15]  497 	sbc	hl,bc       ; HL = 'leftbytes'
      00015F DD 75 04         [19]  498 	ld	4(ix),l     ; IX+4, IX+5 = 'leftbytes'
      000162 DD 74 05         [19]  499 	ld	5(ix),h
                                    500 
                                    501 ;    if (bytes){
      000165 78               [ 4]  502 	ld	a,b
      000166 B1               [ 4]  503 	or	c
      000167 28 17            [12]  504 	jr	z,shl_reg_2
                                    505 
                                    506 ;        if (leftbytes)
      000169 7C               [ 4]  507 	ld	a,h
      00016A B5               [ 4]  508 	or	l
      00016B 28 09            [12]  509 	jr	z,shl_reg_1a
                                    510 
      00016D C5               [11]  511 	push	bc         ; Save 'bytes'
      00016E E5               [11]  512 	push	hl         ; Save 'leftbytes'
                                    513 
                                    514 ;            memmove(&reg[0], &reg[bytes], leftbytes);
      00016F 62               [ 4]  515 	ld	h,d
      000170 6B               [ 4]  516 	ld	l,e
      000171 09               [11]  517 	add	hl,bc       ; DE='reg' HL='reg[bytes]'
      000172 C1               [10]  518 	pop	bc          ; Restore 'leftbytes'
      000173 ED B0            [21]  519 	ldir
                                    520 
      000175 C1               [10]  521 	pop	bc          ; Restore 'bytes'
                                    522 
      000176                        523 shl_reg_1a:
                                    524 
                                    525 ;        memset(&reg[leftbytes],0,bytes);
                                    526 ;    }
                                    527 
      000176 62               [ 4]  528 	ld	h,d  ; Here DE points to the 1st byte to fill w/ zero (obtained from the
      000177 6B               [ 4]  529 	ld	l,e  ; previous LDIR if it took place, or the previous value).
                                    530 
      000178                        531 shl_reg_1b:
                                    532 
      000178 AF               [ 4]  533 	xor	a
      000179 77               [ 7]  534 	ld	(hl),a
      00017A 23               [ 6]  535 	inc	hl
      00017B 0B               [ 6]  536 	dec	bc
      00017C 78               [ 4]  537 	ld	a,b
      00017D B1               [ 4]  538 	or	c
      00017E 20 F8            [12]  539 	jr	nz,shl_reg_1b
                                    540 
      000180                        541 shl_reg_2:
                                    542 
                                    543 ;    if (bits){
      000180 DD 7E 02         [19]  544 	ld	a,2(ix)     ; 'bits'
      000183 B7               [ 4]  545 	or	a
      000184 28 3E            [12]  546 	jr	z,shl_reg_end
                                    547 
                                    548 ;        for (i = 0; i < (leftbytes-1); i++){
                                    549     ; Vai fazer o shift
      000186 DD 4E 04         [19]  550 	ld	c,4(ix)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 11.
Hexadecimal [24-Bits]



      000189 DD 46 05         [19]  551 	ld	b,5(ix)     ;'leftbytes'
      00018C 78               [ 4]  552 	ld	a,b
      00018D B1               [ 4]  553 	or	c
      00018E 28 2B            [12]  554 	jr	z,shl_reg_3
      000190 0B               [ 6]  555 	dec	bc
      000191 78               [ 4]  556 	ld	a,b
      000192 B1               [ 4]  557 	or	c
      000193 28 26            [12]  558 	jr	z,shl_reg_3
                                    559 
      000195 DD 6E 00         [19]  560 	ld	l,(ix)
      000198 DD 66 01         [19]  561 	ld	h,1(ix)     ; HL = 'reg'
                                    562 
      00019B                        563 shl_reg_2a:
                                    564 
                                    565 ;            reg[i] <<= bits;
      00019B DD 7E 02         [19]  566 	ld	a,2(ix)     ; 'bits'
      00019E 5F               [ 4]  567 	ld	e,a          ; 'bits'
      00019F ED 44            [ 8]  568 	neg
      0001A1 C6 08            [ 7]  569 	add	a,#8
      0001A3 57               [ 4]  570 	ld	d,a
      0001A4 7E               [ 7]  571 	ld	a,(hl)
                                    572 
      0001A5                        573 shl_reg_2b:
                                    574 
      0001A5 CB 27            [ 8]  575 	sla	a
      0001A7 1D               [ 4]  576 	dec	e
      0001A8 20 FB            [12]  577 	jr	nz,shl_reg_2b
                                    578 
                                    579 ;            uint8_t aux = reg[i+1] >> (8-bits);
      0001AA 5F               [ 4]  580 	ld	e,a
                                    581 
      0001AB 23               [ 6]  582 	inc	hl
      0001AC 7E               [ 7]  583 	ld	a,(hl)
      0001AD 2B               [ 6]  584 	dec	hl
                                    585 
      0001AE                        586 shl_reg_2c:
                                    587 
      0001AE CB 3F            [ 8]  588 	srl	a
      0001B0 15               [ 4]  589 	dec	d
      0001B1 20 FB            [12]  590 	jr	nz,shl_reg_2c
                                    591 
                                    592 ;            reg[i] |= aux;
                                    593 ;        }
      0001B3 B3               [ 4]  594 	or	e
      0001B4 77               [ 7]  595 	ld	(hl),a
      0001B5 23               [ 6]  596 	inc	hl
                                    597 
      0001B6 0B               [ 6]  598 	dec	bc
      0001B7 78               [ 4]  599 	ld	a,b
      0001B8 B1               [ 4]  600 	or	c
      0001B9 20 E0            [12]  601 	jr	nz,shl_reg_2a
                                    602 
      0001BB                        603 shl_reg_3:
                                    604 ;        reg[leftbytes - 1] <<= bits;
      0001BB 7E               [ 7]  605 	ld	a,(hl)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 12.
Hexadecimal [24-Bits]



      0001BC DD 46 02         [19]  606 	ld	b,2(IX)     ; 'bits'
                                    607 
      0001BF                        608 shl_reg_2d:
                                    609 
      0001BF CB 27            [ 8]  610 	sla	a
      0001C1 10 FC            [13]  611 	djnz	shl_reg_2d
                                    612 
      0001C3 77               [ 7]  613 	ld	(hl),a
                                    614 
                                    615 ;    }
                                    616 
      0001C4                        617 shl_reg_end:
                                    618 
      0001C4 21 08 00         [10]  619 	ld	hl,#0x0008    ; Frees 8 bytes
      0001C7 39               [11]  620 	add	hl,sp
      0001C8 F9               [ 6]  621 	ld	sp,hl
      0001C9 DD E1            [14]  622 	pop	ix
      0001CB C9               [10]  623 	ret
                                    624 
                                    625 ;///////////////////////////////////////////////////////////////////////////////
      0001CC                        626 stack_test:
                                    627 
      0001CC DD E5            [15]  628 	push	ix
      0001CE DD 21 F8 FF      [14]  629 	ld	ix,#0xFFF8    ; Allocates 8 bytes
      0001D2 DD 39            [15]  630 	add	ix,sp
      0001D4 DD F9            [10]  631 	ld	sp,ix
                                    632 
      0001D6 DD 4E 00         [19]  633 	ld	c,(ix)
      0001D9 DD 46 01         [19]  634 	ld	b,1(ix)
                                    635     	;....
      0001DC 21 08 00         [10]  636 	ld	hl,#0x0008    ; Frees 8 bytes
      0001DF 39               [11]  637 	add	hl,sp
      0001E0 F9               [ 6]  638 	ld	sp,hl
      0001E1 DD E1            [14]  639 	pop	ix
      0001E3 C9               [10]  640 	ret
                                    641 
                                    642 ;///////////////////////////////////////////////////////////////////////////////
                                    643 ;   shr_reg
                                    644 ;   void shr_reg(uint8_t *reg, int places);
                                    645 ;   Parameters:
                                    646 ;     DE: reg
                                    647 ;     BC: places
                                    648 ;   Returns: Nothing
                                    649 ;   Affects: BC DE HL AF
      0001E4                        650 shr_reg:
                                    651 
      0001E4 DD E5            [15]  652 	push	ix
      0001E6 DD 21 F8 FF      [14]  653 	ld	ix,#0xFFF8    ; Allocates 8 bytes
      0001EA DD 39            [15]  654 	add	ix,sp
      0001EC DD F9            [10]  655 	ld	sp,ix
                                    656 
      0001EE DD 73 00         [19]  657 	ld	(ix),e     ; IX+0, IX+1 = 'reg'
      0001F1 DD 72 01         [19]  658 	ld	1(ix),d
                                    659 
                                    660 ;    if (places > NBITS)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 13.
Hexadecimal [24-Bits]



                                    661 ;        places = NBITS;
      0001F4 3E 00            [ 7]  662 	ld	a,#(NBITS >> 8)
      0001F6 90               [ 4]  663 	sub	b
      0001F7 38 07            [12]  664 	jr	c,shr_reg_0
      0001F9 20 08            [12]  665 	jr	nz,shr_reg_1
                                    666 
      0001FB 3E 70            [ 7]  667 	ld	a,#(NBITS & #255)
      0001FD 91               [ 4]  668 	sub	c
      0001FE 30 03            [12]  669 	jr	nc, shr_reg_1
                                    670 
      000200                        671 shr_reg_0:
                                    672 
      000200 01 70 00         [10]  673 	ld	bc,#NBITS
                                    674 
      000203                        675 shr_reg_1:
                                    676 
                                    677 ;    int bytes = places >> 3;
                                    678 ;    int bits = places & 0x07;
      000203 79               [ 4]  679 	ld	a,c
      000204 E6 07            [ 7]  680 	and	#0x07
      000206 DD 77 02         [19]  681 	ld	2(ix),a     ; IX+2 = 'bits'
      000209 CB 38            [ 8]  682 	srl	b
      00020B CB 19            [ 8]  683 	rr	c
      00020D CB 38            [ 8]  684 	srl	b
      00020F CB 19            [ 8]  685 	rr	c
      000211 CB 38            [ 8]  686 	srl	b
      000213 CB 19            [ 8]  687 	rr	c            ; BC = 'bytes'
      000215 DD 71 06         [19]  688 	ld	6(ix),c
      000218 DD 70 07         [19]  689 	ld	7(ix),b     ; IX+6, IX+7 = 'bytes'
                                    690 
                                    691 ;    int rightbytes = NBYTES - bytes;
      00021B 21 0E 00         [10]  692 	ld	hl,#NBYTES
      00021E AF               [ 4]  693 	xor	a
      00021F ED 42            [15]  694 	sbc	hl,bc       ; HL = 'rightbytes'
      000221 DD 75 04         [19]  695 	ld	4(ix),l     ; IX+4, IX+5 = 'rightbytes'
      000224 DD 74 05         [19]  696 	ld	5(ix),h
                                    697 
                                    698 ;    if (bytes){
      000227 78               [ 4]  699 	ld	a,b
      000228 B1               [ 4]  700 	or	c
      000229 28 29            [12]  701 	jr	z,shr_reg_2
                                    702 
                                    703 ;        if (rightbytes)
      00022B 7C               [ 4]  704 	ld	a,h
      00022C B5               [ 4]  705 	or	l
      00022D 28 11            [12]  706 	jr	z,shr_reg_1a
                                    707 
                                    708 ;            memmove(&reg[bytes], &reg[0], rightbytes);
      00022F 21 0D 00         [10]  709 	ld	hl,#NBYTES1
      000232 19               [11]  710 	add	hl,de
      000233 54               [ 4]  711 	ld	d,h
      000234 5D               [ 4]  712 	ld	e,l          ; DE = last buffer's byte (destination)
                                    713 
      000235 AF               [ 4]  714 	xor	a           ; BC = 'bytes'
      000236 ED 42            [15]  715 	sbc	hl,bc       ; HL = origem
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 14.
Hexadecimal [24-Bits]



      000238 DD 4E 04         [19]  716 	ld	c,4(ix)     ; 'rightbytes'
      00023B DD 46 05         [19]  717 	ld	b,5(ix)
      00023E ED B8            [21]  718 	lddr
                                    719 
      000240                        720 shr_reg_1a:
                                    721 
                                    722 ;        memset(&reg[0],0,bytes);
      000240 DD 4E 06         [19]  723 	ld	c,6(ix)
      000243 DD 46 07         [19]  724 	ld	b,7(ix)     ; IX+6, IX+7 = 'bytes'
      000246 DD 6E 00         [19]  725 	ld	l,0(ix)
      000249 DD 66 01         [19]  726 	ld	h,1(ix)     ; IX+0, IX+1 = 'reg'
                                    727 
      00024C                        728 shr_reg_1b:
                                    729 
      00024C AF               [ 4]  730 	xor	a
      00024D 77               [ 7]  731 	ld	(hl),a
      00024E 23               [ 6]  732 	inc	hl
      00024F 0B               [ 6]  733 	dec	bc
      000250 78               [ 4]  734 	ld	a,b
      000251 B1               [ 4]  735 	or	c
      000252 20 F8            [12]  736 	jr	nz,shr_reg_1b
                                    737 
                                    738 ;    }
                                    739 
      000254                        740 shr_reg_2:
                                    741 
                                    742 ;    if (bits){
      000254 DD 7E 02         [19]  743 	ld	a,2(ix)     ; 'bits'
      000257 B7               [ 4]  744 	or	a
      000258 28 45            [12]  745 	jr	z,shr_reg_end
                                    746 
                                    747 
                                    748 ;        for (i = NBYTES1; i > bytes; i--){
      00025A 21 0D 00         [10]  749 	ld	hl,#NBYTES1
      00025D DD 4E 06         [19]  750 	ld	c,6(ix)
      000260 DD 46 07         [19]  751 	ld	b,7(ix)     ; IX+6, IX+7 = 'bytes'
      000263 AF               [ 4]  752 	xor	a
      000264 ED 42            [15]  753 	sbc	hl,bc
                                    754 
      000266 7C               [ 4]  755 	ld	a,h
      000267 B5               [ 4]  756 	or	l
      000268 28 2C            [12]  757 	jr	z,shr_reg_2e
                                    758 
      00026A 44               [ 4]  759 	ld	b,h
      00026B 4D               [ 4]  760 	ld	c,l          ; BC = # of bytes to process
                                    761 
      00026C DD 6E 00         [19]  762 	ld	l,0(ix)
      00026F DD 66 01         [19]  763 	ld	h,1(ix)     ; HL = 'reg'
                                    764 
      000272 11 0D 00         [10]  765 	ld	de,#NBYTES1
      000275 19               [11]  766 	add	hl,de
                                    767 
      000276                        768 shr_reg_2a:
                                    769 
                                    770 ;            reg[i] >>= bits;
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 15.
Hexadecimal [24-Bits]



      000276 DD 7E 02         [19]  771 	ld	a,2(ix)     ; 'bits'
      000279 5F               [ 4]  772 	ld	e,a          ; E = 'bits'
      00027A ED 44            [ 8]  773 	neg
      00027C C6 08            [ 7]  774 	add	a,#8
      00027E 57               [ 4]  775 	ld	d,a          ; D = 8 - 'bits'
      00027F 7E               [ 7]  776 	ld	a,(hl)
                                    777 
      000280                        778 shr_reg_2b:
                                    779 
      000280 CB 3F            [ 8]  780 	srl	a
      000282 1D               [ 4]  781 	dec	e
      000283 20 FB            [12]  782 	jr	nz,shr_reg_2b
                                    783 
      000285 5F               [ 4]  784 	ld	e,a
                                    785 
                                    786 ;            uint8_t aux = reg[i-1] << (8-bits);
      000286 2B               [ 6]  787 	dec	hl
      000287 7E               [ 7]  788 	ld	a,(hl)
      000288 23               [ 6]  789 	inc	hl
                                    790 
      000289                        791 shr_reg_2c:
                                    792 
      000289 CB 27            [ 8]  793 	sla	a
      00028B 15               [ 4]  794 	dec	d
      00028C 20 FB            [12]  795 	jr	nz,shr_reg_2c
                                    796 
                                    797 ;            reg[i] |= aux;
      00028E B3               [ 4]  798 	or	e
      00028F 77               [ 7]  799 	ld	(hl),a
                                    800 
                                    801 ;        }
      000290 2B               [ 6]  802 	dec	hl
      000291 0B               [ 6]  803 	dec	bc
      000292 78               [ 4]  804 	ld	a,b
      000293 B1               [ 4]  805 	or	c
      000294 20 E0            [12]  806 	jr	nz,shr_reg_2a
                                    807 
      000296                        808 shr_reg_2e:
                                    809 
                                    810 ;        reg[bytes] >>= bits;
      000296 7E               [ 7]  811 	ld	a,(hl)
      000297 DD 46 02         [19]  812 	ld	b,2(IX)     ; 'bits'
                                    813 
      00029A                        814 shr_reg_2d:
      00029A CB 3F            [ 8]  815 	srl	a
      00029C 10 FC            [13]  816 	djnz	shr_reg_2d
      00029E 77               [ 7]  817 	ld	(hl),a
                                    818 
                                    819 ;    }
                                    820 
      00029F                        821 shr_reg_end:
                                    822 
      00029F 21 08 00         [10]  823 	ld	hl,#0x0008    ; Frees 8 bytes
      0002A2 39               [11]  824 	add	hl,sp
      0002A3 F9               [ 6]  825 	ld	sp,hl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 16.
Hexadecimal [24-Bits]



      0002A4 DD E1            [14]  826 	pop	ix
      0002A6 C9               [10]  827 	ret
                                    828 
                                    829 ;///////////////////////////////////////////////////////////////////////////////
                                    830 ;   mul_reg2_by_reg1
                                    831 ;   void mul_reg2_by_reg1(const uint8_t *reg1, uint8_t *reg2);
                                    832 ;   Parameters:
                                    833 ;     HL: reg1
                                    834 ;     DE: reg2
                                    835 ;   Returns: Nothing
                                    836 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      0002A7                        837 mul_reg2_by_reg1:
                                    838 
      0002A7 DD E5            [15]  839 	push	ix
      0002A9 DD 21 DC FF      [14]  840 	ld	ix,#(0xFFF8-2*NBYTES)    ; Allocates 8 bytes + 2 buffers
      0002AD DD 39            [15]  841 	add	ix,sp
      0002AF DD F9            [10]  842 	ld	sp,ix
                                    843 
      0002B1 DD 75 00         [19]  844 	ld	(ix),l
      0002B4 DD 74 01         [19]  845 	ld	1(ix),h         ; IX+0, IX+1: reg1
      0002B7 DD 73 02         [19]  846 	ld	2(ix),e
      0002BA DD 72 03         [19]  847 	ld	3(ix),d         ; IX+2, IX+3: reg2
                                    848 
                                    849 ;    uint8_t regmdiv[NBYTES];
      0002BD DD                     850 	.db	0xdd
      0002BE 4D               [ 4]  851 	ld	c,l
      0002BF DD                     852 	.db	0xdd
      0002C0 44               [ 4]  853 	ld	b,h            ; Copia IX em BC
      0002C1 21 08 00         [10]  854 	ld	HL,#8
      0002C4 09               [11]  855 	add	hl,bc
      0002C5 DD 75 04         [19]  856 	ld	4(ix),l
      0002C8 DD 74 05         [19]  857 	ld	5(ix),h         ; IX+4, IX+5: regmdiv
                                    858 
                                    859 ;    uint8_t regmdiv2[NBYTES];
      0002CB 01 0E 00         [10]  860 	ld	bc,#NBYTES
      0002CE 09               [11]  861 	add	hl,bc
      0002CF DD 75 06         [19]  862 	ld	6(ix),l
      0002D2 DD 74 07         [19]  863 	ld	7(ix),h         ; IX+6, IX+7: regmdiv2
                                    864 
                                    865 ;    memcpy(regmdiv, reg2, NBYTES);
      0002D5 DD 5E 04         [19]  866 	ld	e,4(ix)
      0002D8 DD 56 05         [19]  867 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0002DB DD 6E 02         [19]  868 	ld	l,2(ix)
      0002DE DD 66 03         [19]  869 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0002E1 01 0E 00         [10]  870 	ld	bc,#NBYTES
      0002E4 ED B0            [21]  871 	ldir
                                    872 
                                    873 ;    memcpy(regmdiv2, reg2, NBYTES);
      0002E6 DD 5E 06         [19]  874 	ld	e,6(ix)
      0002E9 DD 56 07         [19]  875 	ld	d,7(ix)         ; IX+6, IX+7: regmdiv2
      0002EC DD 6E 02         [19]  876 	ld	l,2(ix)
      0002EF DD 66 03         [19]  877 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0002F2 01 0E 00         [10]  878 	ld	bc,#NBYTES
      0002F5 ED B0            [21]  879 	ldir
                                    880 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 17.
Hexadecimal [24-Bits]



                                    881 ;    zero_reg(reg2);
      0002F7 DD 6E 02         [19]  882 	ld	l,2(ix)
      0002FA DD 66 03         [19]  883 	ld	h,3(ix)
      0002FD CD 76 00         [17]  884 	call	zero_reg       ;Zera reg2
                                    885 
                                    886 ;    int places = 0;
      000300 FD 21 00 00      [14]  887 	ld	iy,#0            ; IY = places
                                    888 
                                    889 ;    // Integer part
                                    890 ;    for (int i = NBYTES_INT-1; i>=0; i--){
                                    891 
      000304 01 02 00         [10]  892 	ld	bc,#NBYTES_INT
      000307 DD 6E 00         [19]  893 	ld	l,(ix)
      00030A DD 66 01         [19]  894 	ld	h,1(ix)       ; IX+0, IX+1: reg1
      00030D 09               [11]  895 	add	hl,bc
      00030E 2B               [ 6]  896 	dec	hl            ; HL: buffer to process
                                    897 
      00030F                        898 mul_reg2_by_reg1_1:
                                    899 
                                    900 ;        int msk = 1;
      00030F 16 01            [ 7]  901 	ld	d,#1
                                    902 
                                    903 ;        for (int j = 0; j < 8; j++){
      000311 1E 08            [ 7]  904 	ld	e,#8
                                    905 
      000313                        906 mul_reg2_by_reg1_2:
                                    907 
                                    908 ;            if (reg1[i] & msk){
      000313 7E               [ 7]  909 	ld	a,(hl)
      000314 A2               [ 4]  910 	and	d
      000315 28 28            [12]  911 	jr	z, mul_reg2_by_reg1_3
                                    912 
                                    913 ;                shl_reg(regmdiv,places);
      000317 C5               [11]  914 	push	bc
      000318 D5               [11]  915 	push	de
      000319 E5               [11]  916 	push	hl
                                    917 
      00031A DD 5E 04         [19]  918 	ld	e,4(ix)
      00031D DD 56 05         [19]  919 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      000320 FD                     920 	.db	0xfd
      000321 44               [ 4]  921 	ld	b,h
      000322 FD                     922 	.db	0xfd
      000323 4D               [ 4]  923 	ld	c,l            ; BC gets IY = 'places'
      000324 CD 28 01         [17]  924 	call	shl_reg
                                    925 
                                    926 ;                add_reg2_to_reg1(reg2, regmdiv);
      000327 DD 5E 02         [19]  927 	ld	e,2(ix)
      00032A DD 56 03         [19]  928 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      00032D DD 6E 04         [19]  929 	ld	l,4(ix)
      000330 DD 66 05         [19]  930 	ld	h,5(ix)         ; IX+4, IX+5: regmdiv
      000333 CD B1 00         [17]  931 	call	add_reg2_to_reg1
                                    932 
      000336 E1               [10]  933 	pop	hl
      000337 D1               [10]  934 	pop	de
      000338 C1               [10]  935 	pop	bc
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 18.
Hexadecimal [24-Bits]



                                    936 
                                    937 ;                places = 1;
      000339 FD 21 01 00      [14]  938 	ld	iy,#1     ; IY = places
                                    939 ;            }
                                    940 ;            else
                                    941 ;                places++;
      00033D 18 02            [12]  942 	jr	mul_reg2_by_reg1_4
                                    943 
      00033F                        944 mul_reg2_by_reg1_3:
                                    945 
      00033F FD 23            [10]  946 	inc	iy
                                    947 
      000341                        948 mul_reg2_by_reg1_4:
                                    949 
                                    950 ;            msk <<= 1;
      000341 7A               [ 4]  951 	ld	a,d
      000342 CB 27            [ 8]  952 	sla	a
      000344 57               [ 4]  953 	ld	d,a
                                    954 
                                    955 ;        }
      000345 1D               [ 4]  956 	dec	e
      000346 20 CB            [12]  957 	jr	nz,mul_reg2_by_reg1_2
                                    958 
                                    959 ;    }
      000348 2B               [ 6]  960 	dec	hl
      000349 0B               [ 6]  961 	dec	bc
      00034A 78               [ 4]  962 	ld	a,b
      00034B B1               [ 4]  963 	or	c
      00034C 20 C1            [12]  964 	jr	nz,mul_reg2_by_reg1_1
                                    965 
                                    966 ;    memcpy(regmdiv, regmdiv2, NBYTES);
      00034E DD 6E 06         [19]  967 	ld	l,6(ix)
      000351 DD 66 07         [19]  968 	ld	h,7(ix)         ; IX+6, IX+7: regmdiv2
      000354 DD 5E 04         [19]  969 	ld	e,4(ix)
      000357 DD 56 05         [19]  970 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00035A 01 0E 00         [10]  971 	ld	bc,#NBYTES
      00035D ED B0            [21]  972 	ldir
                                    973 
                                    974 ;    shr_reg(regmdiv,1);
      00035F DD 5E 04         [19]  975 	ld	e,4(ix)
      000362 DD 56 05         [19]  976 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      000365 01 01 00         [10]  977 	ld	bc,#1
      000368 CD E4 01         [17]  978 	call	shr_reg
                                    979 
                                    980 ;    places = 0;
      00036B FD 21 00 00      [14]  981 	ld	iy,#0
                                    982 
                                    983 ;    //Frac part
                                    984 ;    for (int i = NBYTES_INT; i < NBYTES; i++){
      00036F DD 6E 00         [19]  985 	ld	l,(ix)
      000372 DD 66 01         [19]  986 	ld	h,1(ix)         ; IX+0, IX+1: reg1
      000375 01 02 00         [10]  987 	ld	bc,#NBYTES_INT
      000378 09               [11]  988 	add	hl,bc
      000379 01 0C 00         [10]  989 	ld	bc, #(NBYTES - NBYTES_INT)
                                    990 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 19.
Hexadecimal [24-Bits]



      00037C                        991 mul_reg2_by_reg1_5:
                                    992 
                                    993 ;        int msk = 128;
      00037C 16 80            [ 7]  994 	ld	d,#128
                                    995 
                                    996 ;        for (int j = 0; j < 8; j++){
      00037E 1E 08            [ 7]  997 	ld	e,#8
                                    998 
      000380                        999 mul_reg2_by_reg1_6:
                                   1000 
                                   1001 ;            if (reg1[i] & msk){
      000380 7E               [ 7] 1002 	ld	a,(hl)
      000381 A2               [ 4] 1003 	and	d
      000382 28 28            [12] 1004 	jr	z,mul_reg2_by_reg1_7
                                   1005 
      000384 C5               [11] 1006 	push	bc
      000385 D5               [11] 1007 	push	de
      000386 E5               [11] 1008 	push	hl
                                   1009 
                                   1010 ;                shr_reg(regmdiv,places);
      000387 DD 5E 04         [19] 1011 	ld	e,4(ix)
      00038A DD 56 05         [19] 1012 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00038D FD                    1013 	.db	0xfd
      00038E 44               [ 4] 1014 	ld	b,h
      00038F FD                    1015 	.db	0xfd
      000390 4D               [ 4] 1016 	ld	c,l            ; BC <- IY = 'places'
      000391 CD E4 01         [17] 1017 	call	shr_reg
                                   1018 
                                   1019 ;                add_reg2_to_reg1(reg2, regmdiv);
      000394 DD 5E 02         [19] 1020 	ld	e,2(ix)
      000397 DD 56 03         [19] 1021 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      00039A DD 6E 04         [19] 1022 	ld	l,4(ix)
      00039D DD 66 05         [19] 1023 	ld	h,5(ix)         ; IX+4, IX+5: regmdiv
      0003A0 CD B1 00         [17] 1024 	call	add_reg2_to_reg1
                                   1025 
      0003A3 E1               [10] 1026 	pop	hl
      0003A4 D1               [10] 1027 	pop	de
      0003A5 C1               [10] 1028 	pop	bc
                                   1029 
                                   1030 ;                places = 1;
      0003A6 FD 21 01 00      [14] 1031 	ld	iy,#1
      0003AA 18 02            [12] 1032 	jr	mul_reg2_by_reg1_8
                                   1033 ;            }
                                   1034 ;            else
                                   1035 ;                places++;
      0003AC                       1036 mul_reg2_by_reg1_7:
                                   1037 
      0003AC FD 23            [10] 1038 	inc	iy
                                   1039 
      0003AE                       1040 mul_reg2_by_reg1_8:
                                   1041 
                                   1042 ;            msk >>= 1;
      0003AE 7A               [ 4] 1043 	ld	a,d
      0003AF CB 3F            [ 8] 1044 	srl a
      0003B1 57               [ 4] 1045 	ld	d,a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 20.
Hexadecimal [24-Bits]



                                   1046 
                                   1047 ;        }
      0003B2 1D               [ 4] 1048 	dec	e
      0003B3 20 CB            [12] 1049 	jr	nz, mul_reg2_by_reg1_6
                                   1050 
                                   1051 ;    }
      0003B5 23               [ 6] 1052 	inc	hl
      0003B6 0B               [ 6] 1053 	dec	bc
      0003B7 78               [ 4] 1054 	ld	a,b
      0003B8 B1               [ 4] 1055 	or	c
      0003B9 20 C1            [12] 1056 	jr	nz,mul_reg2_by_reg1_5
                                   1057 
      0003BB                       1058 mul_reg2_by_reg1_end:
                                   1059 
      0003BB 21 24 00         [10] 1060 	ld	hl,#(0x0008+(2*NBYTES))    ; Frees 8 bytes + 2 buffers
      0003BE 39               [11] 1061 	add	hl,sp
      0003BF F9               [ 6] 1062 	ld	sp,hl
      0003C0 DD E1            [14] 1063 	pop	ix
      0003C2 C9               [10] 1064 	ret
                                   1065 
                                   1066 ;///////////////////////////////////////////////////////////////////////////////
                                   1067 ;   mul_acc_by_reg
                                   1068 ;   void mul_acc_by_reg(const uint8_t *reg);
                                   1069 ;   Parameters:
                                   1070 ;     HL: reg
                                   1071 ;   Returns: Nothing
                                   1072 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      0003C3                       1073 mul_acc_by_reg:
                                   1074 
                                   1075 ;    mul_reg2_by_reg1(reg, acc);
      0003C3 11 00 40         [10] 1076 	ld	de,#acc
      0003C6 CD A7 02         [17] 1077 	call	mul_reg2_by_reg1
      0003C9 C9               [10] 1078 	ret
                                   1079 
                                   1080 ;///////////////////////////////////////////////////////////////////////////////
                                   1081 ;   mul_reg_10
                                   1082 ;   void mul_reg_10(uint8_t *reg);
                                   1083 ;   Parameters:
                                   1084 ;     DE: reg
                                   1085 ;   Returns: Nothing
                                   1086 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      0003CA                       1087 mul_reg_10:
                                   1088 
      0003CA DD E5            [15] 1089 	push	ix
      0003CC DD 21 EA FF      [14] 1090 	ld	ix,#(0xFFF8-NBYTES)    ; Allocates 8 bytes + buffer
      0003D0 DD 39            [15] 1091 	add	ix,sp
      0003D2 DD F9            [10] 1092 	ld	sp,ix
                                   1093 
      0003D4 DD 73 00         [19] 1094 	ld	(ix),e
      0003D7 DD 72 01         [19] 1095 	ld	1(ix),d         ; IX+0, IX+1: reg
                                   1096 
                                   1097 ;    uint8_t regmdiv[NBYTES];
      0003DA DD                    1098 	.db	0xdd
      0003DB 4D               [ 4] 1099 	ld	c,l
      0003DC DD                    1100 	.db	0xdd
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 21.
Hexadecimal [24-Bits]



      0003DD 44               [ 4] 1101 	ld	b,h            ; Copy IX -> BC
      0003DE 21 08 00         [10] 1102 	ld	HL,#8
      0003E1 09               [11] 1103 	add	hl,bc
      0003E2 DD 75 04         [19] 1104 	ld	4(ix),l
      0003E5 DD 74 05         [19] 1105 	ld	5(ix),h         ; IX+4, IX+5: regmdiv
                                   1106 
                                   1107 ;    memcpy(regmdiv, reg, NBYTES);
      0003E8 DD 5E 04         [19] 1108 	ld	e,4(ix)
      0003EB DD 56 05         [19] 1109 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0003EE DD 6E 00         [19] 1110 	ld	l,(ix)
      0003F1 DD 66 01         [19] 1111 	ld	h,1(ix)         ; IX+0, IX+1: reg
      0003F4 01 0E 00         [10] 1112 	ld	bc,#NBYTES
      0003F7 ED B0            [21] 1113 	ldir
                                   1114 
                                   1115 ;    shl_reg(reg, 1);
      0003F9 DD 5E 00         [19] 1116 	ld	e,(ix)
      0003FC DD 56 01         [19] 1117 	ld	d,1(ix)         ; IX+0, IX+1: reg
      0003FF 01 01 00         [10] 1118 	ld	bc,#1
      000402 CD 28 01         [17] 1119 	call	shl_reg
                                   1120 
                                   1121 ;    shl_reg(regmdiv, 3);
      000405 DD 5E 04         [19] 1122 	ld	e,4(ix)
      000408 DD 56 05         [19] 1123 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00040B 01 03 00         [10] 1124 	ld	bc,#3
      00040E CD 28 01         [17] 1125 	call	shl_reg
                                   1126 
                                   1127 ;    add_reg2_to_reg1(reg,regmdiv);
      000411 DD 5E 00         [19] 1128 	ld	e,(ix)
      000414 DD 56 01         [19] 1129 	ld	d,1(ix)         ; IX+0, IX+1: reg
      000417 DD 6E 04         [19] 1130 	ld	l,4(ix)
      00041A DD 66 05         [19] 1131 	ld	h,5(ix)         ; IX+4, IX+5: regmdiv
      00041D CD B1 00         [17] 1132 	call	add_reg2_to_reg1
                                   1133 
      000420 21 16 00         [10] 1134 	ld	hl,#(0x0008+NBYTES)    ; Frees 8 bytes + buffer
      000423 39               [11] 1135 	add	hl,sp
      000424 F9               [ 6] 1136 	ld	sp,hl
      000425 DD E1            [14] 1137 	pop	ix
      000427 C9               [10] 1138 	ret
                                   1139 
                                   1140 ;///////////////////////////////////////////////////////////////////////////////
                                   1141 ;   compare
                                   1142 ;   int compare (const uint8_t *reg1, const uint8_t *reg2);
                                   1143 ;   Parameters:
                                   1144 ;     HL: reg1
                                   1145 ;     DE: reg2
                                   1146 ;   Returns: Flags: Z:        reg1 = reg2
                                   1147 ;                   NZ & C:   reg1 < reg2
                                   1148 ;                   NC & NC:  reg1 > reg2
                                   1149 ;   Affects: BC DE HL AF
      000428                       1150 compare:
                                   1151 
                                   1152 ;    for (int i = 0; i < NBYTES; i++){
      000428 01 0E 00         [10] 1153 	ld	bc,#NBYTES
                                   1154 
      00042B                       1155 compare_1:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 22.
Hexadecimal [24-Bits]



                                   1156 
                                   1157 ;        if (reg1[i] < reg2[i]) return -1;   // reg1 < reg2
                                   1158 ;        if (reg1[i] > reg2[i]) return 1;    // reg1 > reg2
                                   1159 ;    }
                                   1160 
      00042B 1A               [ 7] 1161 	ld	a,(de)
      00042C ED A1            [16] 1162 	cpi
      00042E 20 06            [12] 1163 	jr	nz,compare_2
      000430 13               [ 6] 1164 	inc	de
      000431 EA 2B 04         [10] 1165 	jp	pe,compare_1
                                   1166 
                                   1167 ;	return 0;   // Same value
      000434 AF               [ 4] 1168 	xor	a
      000435 C9               [10] 1169 	ret
                                   1170 
      000436                       1171 compare_2:
      000436 2B               [ 6] 1172 	dec	hl
      000437 BE               [ 7] 1173 	cp	(hl)
      000438 3F               [ 4] 1174 	ccf
      000439 C9               [10] 1175 	ret
                                   1176 
                                   1177 ;///////////////////////////////////////////////////////////////////////////////
                                   1178 ;   iszero
                                   1179 ;   int iszero (const uint8_t *reg);
                                   1180 ;   Parameters:
                                   1181 ;     HL: reg
                                   1182 ;   Returns: Flags: Z:        reg = 0
                                   1183 ;                   NZ:       reg1 != 0
                                   1184 ;   Affects: BC DE HL AF
      00043A                       1185 iszero:
                                   1186 
                                   1187 ;    for (int i = 0; i < NBYTES; i++){
      00043A 01 0E 00         [10] 1188 	ld	bc,#NBYTES
      00043D AF               [ 4] 1189 	xor	a
                                   1190 
      00043E                       1191 iszero_1:
                                   1192 
                                   1193 ;        if (reg[i]) return 0;   // nonzero
      00043E ED A1            [16] 1194 	cpi
      000440 C0               [11] 1195 	ret	nz
                                   1196 
                                   1197 ;    }
      000441 EA 3E 04         [10] 1198 	jp	pe,iszero_1
                                   1199 
                                   1200 ;	return 1;   // Is zero
      000444 AF               [ 4] 1201 	xor	a
      000445 C9               [10] 1202 	ret
                                   1203 
                                   1204 ;///////////////////////////////////////////////////////////////////////////////
                                   1205 ;   div_reg2_by_reg1
                                   1206 ;   int div_reg2_by_reg1(const uint8_t *reg1, uint8_t *reg2);
                                   1207 ;   Parameters:
                                   1208 ;     HL: reg1
                                   1209 ;     DE: reg2
                                   1210 ;   Returns: Flags: Z:        Div OK
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 23.
Hexadecimal [24-Bits]



                                   1211 ;                   NZ:       Div Error
                                   1212 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      000446                       1213 div_reg2_by_reg1:
                                   1214 
      000446 DD E5            [15] 1215 	push	ix
      000448 DD 21 CC FF      [14] 1216 	ld	ix,#(0xFFF6-3*NBYTES)    ; Allocates 10 bytes + 3 buffers
      00044C DD 39            [15] 1217 	add	ix,sp
      00044E DD F9            [10] 1218 	ld	sp,ix
                                   1219 
      000450 DD 75 00         [19] 1220 	ld	(ix),l
      000453 DD 74 01         [19] 1221 	ld	1(ix),h         ; IX+0, IX+1: reg1
      000456 DD 73 02         [19] 1222 	ld	2(ix),e
      000459 DD 72 03         [19] 1223 	ld	3(ix),d         ; IX+2, IX+3: reg2
                                   1224 
                                   1225 ;    uint8_t regmdiv[NBYTES];
      00045C DD                    1226 	.db	0xdd
      00045D 4D               [ 4] 1227 	ld	c,l
      00045E DD                    1228 	.db	0xdd
      00045F 44               [ 4] 1229 	ld	b,h            ; Copia IX em BC
      000460 21 0A 00         [10] 1230 	ld	HL,#10
      000463 09               [11] 1231 	add	hl,bc
      000464 DD 75 04         [19] 1232 	ld	4(ix),l
      000467 DD 74 05         [19] 1233 	ld	5(ix),h         ; IX+4, IX+5: regmdiv
                                   1234 
                                   1235 ;    uint8_t regmdiv2[NBYTES];
      00046A 01 0E 00         [10] 1236 	ld	bc,#NBYTES
      00046D 09               [11] 1237 	add	hl,bc
      00046E DD 75 06         [19] 1238 	ld	6(ix),l
      000471 DD 74 07         [19] 1239 	ld	7(ix),h         ; IX+6, IX+7: regmdiv2
                                   1240 
                                   1241 ;    if (iszero(reg1)) return -1; // Divide by zero
      000474 DD 6E 00         [19] 1242 	ld	l,(ix)
      000477 DD 66 01         [19] 1243 	ld	h,1(ix)         ; IX+0, IX+1: reg
      00047A CD 3A 04         [17] 1244 	call	iszero
      00047D 20 05            [12] 1245 	jr	nz, div_reg2_by_reg1_1
      00047F 3E FF            [ 7] 1246 	ld	a,#0xff
      000481 C3 15 06         [10] 1247 	jp	div_reg2_by_reg1_end
                                   1248 
      000484                       1249 div_reg2_by_reg1_1:
                                   1250 
                                   1251 ;    int res = compare (reg2, reg1);
                                   1252 ;    if (res == 0){   // iguais
                                   1253 ;        zero_reg(reg2);
                                   1254 ;        set_bit_reg_int(reg2, 0);    //1
                                   1255 ;    	return 0;   //ok
                                   1256 ;    }
      000484 DD 6E 00         [19] 1257 	ld	l,(ix)
      000487 DD 66 01         [19] 1258 	ld	h,1(ix)         ; IX+0, IX+1: reg1
      00048A DD 5E 02         [19] 1259 	ld	e,2(ix)
      00048D DD 56 03         [19] 1260 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      000490 CD 28 04         [17] 1261 	call	compare
      000493 20 19            [12] 1262 	jr	nz, div_reg2_by_reg1_2
                                   1263 
      000495 DD 6E 02         [19] 1264 	ld	l,2(ix)
      000498 DD 66 03         [19] 1265 	ld	h,3(ix)         ; IX+2, IX+3: reg2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 24.
Hexadecimal [24-Bits]



      00049B CD 76 00         [17] 1266 	call	zero_reg
      00049E DD 6E 02         [19] 1267 	ld	l,2(ix)
      0004A1 DD 66 03         [19] 1268 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0004A4 01 00 00         [10] 1269 	ld	bc,#0
      0004A7 CD AB 00         [17] 1270 	call	set_bit_reg_int
      0004AA AF               [ 4] 1271 	xor	a
      0004AB C3 15 06         [10] 1272 	jp	div_reg2_by_reg1_end
                                   1273 
      0004AE                       1274 div_reg2_by_reg1_2:
                                   1275 
                                   1276 ;    uint8_t regquot[NBYTES];
      0004AE 01 0E 00         [10] 1277 	ld	bc,#NBYTES
      0004B1 DD 6E 06         [19] 1278 	ld	l,6(ix)
      0004B4 DD 66 07         [19] 1279 	ld	h,7(ix)         ; IX+6, IX+7: regmdiv2
      0004B7 09               [11] 1280 	add	hl,bc
      0004B8 DD 75 08         [19] 1281 	ld	8(ix),l
      0004BB DD 74 09         [19] 1282 	ld	9(ix),h         ; IX+8, IX+9: regquot
                                   1283 
                                   1284 ;    zero_reg(regquot);
                                   1285     	;ld l,8(ix)
                                   1286     	;ld h,9(ix)         ; IX+8, IX+9: regquot
      0004BE CD 76 00         [17] 1287 	call	zero_reg
                                   1288 
                                   1289 ;    memcpy(regmdiv, reg1, NBYTES);
      0004C1 DD 5E 04         [19] 1290 	ld	e,4(ix)
      0004C4 DD 56 05         [19] 1291 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0004C7 DD 6E 00         [19] 1292 	ld	l,(ix)
      0004CA DD 66 01         [19] 1293 	ld	h,1(ix)         ; IX+0, IX+1: reg1
      0004CD 01 0E 00         [10] 1294 	ld	bc,#NBYTES
      0004D0 ED B0            [21] 1295 	ldir
                                   1296 
                                   1297 ;    memcpy(regmdiv2, reg1, NBYTES);
      0004D2 DD 5E 06         [19] 1298 	ld	e,6(ix)
      0004D5 DD 56 07         [19] 1299 	ld	d,7(ix)         ; IX+6, IX+7: regmdiv2
      0004D8 DD 6E 00         [19] 1300 	ld	l,(ix)
      0004DB DD 66 01         [19] 1301 	ld	h,1(ix)         ; IX+0, IX+1: reg1
      0004DE 01 0E 00         [10] 1302 	ld	bc,#NBYTES
      0004E1 ED B0            [21] 1303 	ldir
                                   1304 
                                   1305 ;    for (;!iszero(reg2);){
      0004E3                       1306 div_reg2_by_reg1_3:
                                   1307 
      0004E3 DD 6E 02         [19] 1308 	ld	l,2(ix)
      0004E6 DD 66 03         [19] 1309 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0004E9 CD 3A 04         [17] 1310 	call	iszero
      0004EC CA 03 06         [10] 1311 	jp	z, div_reg2_by_reg1_5
                                   1312 
                                   1313 ;        int res = compare (reg2, regmdiv);
      0004EF DD 6E 02         [19] 1314 	ld	l,2(ix)
      0004F2 DD 66 03         [19] 1315 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0004F5 DD 5E 04         [19] 1316 	ld	e,4(ix)
      0004F8 DD 56 05         [19] 1317 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0004FB CD 28 04         [17] 1318 	call	compare
                                   1319 
                                   1320 ;        if (res == -1){ // reg2 < regmdiv
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 25.
Hexadecimal [24-Bits]



      0004FE D2 7F 05         [10] 1321 	jp	nc, div_reg2_by_reg1_4
      000501 CA 7F 05         [10] 1322 	jp	z, div_reg2_by_reg1_4
                                   1323 
                                   1324 ;            int order = 0;
      000504 FD 21 00 00      [14] 1325 	ld	iy,#0
                                   1326 
                                   1327 ;            for (;!iszero(reg2);){
      000508                       1328 div_reg2_by_reg1_3a:
                                   1329 
      000508 DD 6E 02         [19] 1330 	ld	l,2(ix)
      00050B DD 66 03         [19] 1331 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      00050E CD 3A 04         [17] 1332 	call	iszero
      000511 28 57            [12] 1333 	jr	z, div_reg2_by_reg1_3b
                                   1334 
                                   1335 ;                if (compare(reg2, regmdiv) < 0){ //reg2 < regmdiv
                                   1336 
      000513 DD 6E 02         [19] 1337 	ld	l,2(ix)
      000516 DD 66 03         [19] 1338 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      000519 DD 5E 04         [19] 1339 	ld	e,4(ix)
      00051C DD 56 05         [19] 1340 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00051F CD 28 04         [17] 1341 	call	compare
      000522 30 1F            [12] 1342 	jr	nc, div_reg2_by_reg1_3c
      000524 28 1D            [12] 1343 	jr	z, div_reg2_by_reg1_3c
                                   1344 
                                   1345 ;                    shr_reg(regmdiv, 1);
      000526 DD 5E 04         [19] 1346 	ld	e,4(ix)
      000529 DD 56 05         [19] 1347 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00052C 01 01 00         [10] 1348 	ld	bc,#1
      00052F CD E4 01         [17] 1349 	call	shr_reg
                                   1350 
                                   1351 ;                    order++;
      000532 FD 23            [10] 1352 	inc	iy
                                   1353 ;                    if (order >= NBITS_FRAC){
                                   1354 ;                        memcpy(reg2, regquot, NBYTES);
                                   1355 ;                    	return 0;
                                   1356 ;                    }
      000534 FD                    1357 	.db	0xfd
      000535 54               [ 4] 1358 	ld	d,h
      000536 FD                    1359 	.db	0xfd
      000537 5D               [ 4] 1360 	ld	e,l
      000538 EB               [ 4] 1361 	ex de,hl
      000539 11 60 00         [10] 1362 	ld	de,#NBITS_FRAC
      00053C AF               [ 4] 1363 	xor	a
      00053D ED 52            [15] 1364 	sbc	hl,de
      00053F 30 29            [12] 1365 	jr	nc, div_reg2_by_reg1_3b
                                   1366 
                                   1367 ;                   continue;
      000541 18 C5            [12] 1368 	jr	div_reg2_by_reg1_3a
                                   1369 ;                }
                                   1370 
      000543                       1371 div_reg2_by_reg1_3c:
                                   1372 
                                   1373 ;                sub_reg2_from_reg1(reg2, regmdiv);
      000543 DD 6E 04         [19] 1374 	ld	l,4(ix)
      000546 DD 66 05         [19] 1375 	ld	h,5(ix)         ; IX+0, IX+1: regmdiv
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 26.
Hexadecimal [24-Bits]



      000549 DD 5E 02         [19] 1376 	ld	e,2(ix)
      00054C DD 56 03         [19] 1377 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      00054F CD 03 01         [17] 1378 	call	sub_reg2_from_reg1
                                   1379 
                                   1380 ;                set_bit_reg(regquot, NBITS_FRAC - order);
      000552 21 60 00         [10] 1381 	ld	hl,#NBITS_FRAC
      000555 FD                    1382 	.db	0xfd
      000556 4D               [ 4] 1383 	ld	c,l
      000557 FD                    1384 	.db	0xfd
      000558 44               [ 4] 1385 	ld	b,h
      000559 AF               [ 4] 1386 	xor	a
      00055A ED 42            [15] 1387 	sbc	hl,bc
      00055C 4D               [ 4] 1388 	ld	c,l
      00055D 44               [ 4] 1389 	ld	b,h
      00055E DD 6E 08         [19] 1390 	ld	l,8(ix)
      000561 DD 66 09         [19] 1391 	ld	h,9(ix)         ; IX+8, IX+9: regquot
      000564 CD 81 00         [17] 1392 	call	set_bit_reg
                                   1393 
                                   1394 ;            }
      000567 C3 08 05         [10] 1395 	jp	div_reg2_by_reg1_3a
                                   1396 
      00056A                       1397 div_reg2_by_reg1_3b:
                                   1398 
                                   1399 ;            memcpy(reg2, regquot, NBYTES);
      00056A DD 5E 02         [19] 1400 	ld	e,2(ix)
      00056D DD 56 03         [19] 1401 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      000570 DD 6E 08         [19] 1402 	ld	l,8(ix)
      000573 DD 66 09         [19] 1403 	ld	h,9(ix)         ; IX+8, IX+9: regquot
      000576 01 0E 00         [10] 1404 	ld	bc,#NBYTES
      000579 ED B0            [21] 1405 	ldir
                                   1406 
                                   1407 ;        	return 0;
      00057B AF               [ 4] 1408 	xor	a
      00057C C3 15 06         [10] 1409 	jp	div_reg2_by_reg1_end
                                   1410 
                                   1411 ;        }
                                   1412 ;        else{   // reg2 >= regmdiv
                                   1413 
      00057F                       1414 div_reg2_by_reg1_4:
                                   1415 
                                   1416 ;            int order = 0;
      00057F FD 21 00 00      [14] 1417 	ld	iy,#0
                                   1418 
                                   1419 ;            for (;;){
      000583                       1420 div_reg2_by_reg1_4a:
                                   1421 
                                   1422 ;                if (compare(reg2, regmdiv) < 0){ //reg2 < regmdiv
                                   1423 ;                    break;
                                   1424 ;                }
      000583 DD 6E 02         [19] 1425 	ld	l,2(ix)
      000586 DD 66 03         [19] 1426 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      000589 DD 5E 04         [19] 1427 	ld	e,4(ix)
      00058C DD 56 05         [19] 1428 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00058F CD 28 04         [17] 1429 	call	compare
      000592 38 21            [12] 1430 	jr	c, div_reg2_by_reg1_4b
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 27.
Hexadecimal [24-Bits]



                                   1431 
                                   1432 ;                shl_reg(regmdiv, 1);
      000594 01 01 00         [10] 1433 	ld	bc,#1
      000597 DD 5E 04         [19] 1434 	ld	e,4(ix)
      00059A DD 56 05         [19] 1435 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      00059D CD 28 01         [17] 1436 	call	shl_reg
                                   1437 
                                   1438 ;                if (compare(reg2, regmdiv) < 0){ //reg2 < regmdiv
                                   1439 ;                    break;
                                   1440 ;                }
      0005A0 DD 6E 02         [19] 1441 	ld	l,2(ix)
      0005A3 DD 66 03         [19] 1442 	ld	h,3(ix)         ; IX+2, IX+3: reg2
      0005A6 DD 5E 04         [19] 1443 	ld	e,4(ix)
      0005A9 DD 56 05         [19] 1444 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0005AC CD 28 04         [17] 1445 	call	compare
      0005AF 38 04            [12] 1446 	jr	c, div_reg2_by_reg1_4b
                                   1447 
                                   1448 ;                order++;
      0005B1 FD 23            [10] 1449 	inc	iy
                                   1450 
                                   1451 ;            }
      0005B3 18 CE            [12] 1452 	jr	div_reg2_by_reg1_4a
                                   1453 
      0005B5                       1454 div_reg2_by_reg1_4b:
                                   1455 
                                   1456 ;            memcpy(regmdiv, regmdiv2, NBYTES);
      0005B5 DD 5E 04         [19] 1457 	ld	e,4(ix)
      0005B8 DD 56 05         [19] 1458 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0005BB DD 6E 06         [19] 1459 	ld	l,6(ix)
      0005BE DD 66 07         [19] 1460 	ld	h,7(ix)         ; IX+6, IX+7: regmdiv2
      0005C1 01 0E 00         [10] 1461 	ld	bc,#NBYTES
      0005C4 ED B0            [21] 1462 	ldir
                                   1463 
                                   1464 ;            shl_reg(regmdiv, order);
      0005C6 FD                    1465 	.db	0xfd
      0005C7 4D               [ 4] 1466 	ld	c,l
      0005C8 FD                    1467 	.db	0xfd
      0005C9 44               [ 4] 1468 	ld	b,h
      0005CA DD 5E 04         [19] 1469 	ld	e,4(ix)
      0005CD DD 56 05         [19] 1470 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0005D0 CD 28 01         [17] 1471 	call	shl_reg
                                   1472 
                                   1473 ;            sub_reg2_from_reg1(reg2, regmdiv);
      0005D3 DD 5E 02         [19] 1474 	ld	e,2(ix)
      0005D6 DD 56 03         [19] 1475 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      0005D9 DD 6E 04         [19] 1476 	ld	l,4(ix)
      0005DC DD 66 05         [19] 1477 	ld	h,5(ix)         ; IX+4, IX+5: regmdiv
      0005DF CD 03 01         [17] 1478 	call	sub_reg2_from_reg1
                                   1479 
                                   1480 ;            set_bit_reg_int(regquot, order);
      0005E2 DD 6E 08         [19] 1481 	ld	l,8(ix)
      0005E5 DD 66 09         [19] 1482 	ld	h,9(ix)         ; IX+8, IX+9: regquot
      0005E8 FD                    1483 	.db	0xfd
      0005E9 4D               [ 4] 1484 	ld	c,l
      0005EA FD                    1485 	.db	0xfd
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 28.
Hexadecimal [24-Bits]



      0005EB 44               [ 4] 1486 	ld	b,h
      0005EC CD AB 00         [17] 1487 	call	set_bit_reg_int
                                   1488 
                                   1489 ;            memcpy(regmdiv, regmdiv2, NBYTES);
      0005EF DD 5E 04         [19] 1490 	ld	e,4(ix)
      0005F2 DD 56 05         [19] 1491 	ld	d,5(ix)         ; IX+4, IX+5: regmdiv
      0005F5 DD 6E 06         [19] 1492 	ld	l,6(ix)
      0005F8 DD 66 07         [19] 1493 	ld	h,7(ix)         ; IX+6, IX+7: regmdiv2
      0005FB 01 0E 00         [10] 1494 	ld	bc,#NBYTES
      0005FE ED B0            [21] 1495 	ldir
                                   1496 
                                   1497 ;        }
                                   1498 ;    }
      000600 C3 E3 04         [10] 1499 	jp	div_reg2_by_reg1_3
                                   1500 
      000603                       1501 div_reg2_by_reg1_5:
                                   1502 
                                   1503 ;    memcpy(reg2, regquot, NBYTES);
      000603 DD 5E 02         [19] 1504 	ld	e,2(ix)
      000606 DD 56 03         [19] 1505 	ld	d,3(ix)         ; IX+2, IX+3: reg2
      000609 DD 6E 08         [19] 1506 	ld	l,8(ix)
      00060C DD 66 09         [19] 1507 	ld	h,9(ix)         ; IX+8, IX+9: regquot
      00060F 01 0E 00         [10] 1508 	ld	bc,#NBYTES
      000612 ED B0            [21] 1509 	ldir
                                   1510 
                                   1511 ;	return 0;
      000614 AF               [ 4] 1512 	xor	a
                                   1513 
      000615                       1514 div_reg2_by_reg1_end:
                                   1515 
      000615 21 34 00         [10] 1516 	ld	hl,#(0x000A+3*NBYTES)    ; Frees 10 bytes + 3 buffers
      000618 39               [11] 1517 	add	hl,sp
      000619 F9               [ 6] 1518 	ld	sp,hl
      00061A DD E1            [14] 1519 	pop	ix
      00061C B7               [ 4] 1520 	or	a
      00061D C9               [10] 1521 	ret
                                   1522 
                                   1523 ;///////////////////////////////////////////////////////////////////////////////
                                   1524 ;   div_acc_by_reg
                                   1525 ;   int div_acc_by_reg(const uint8_t *reg)
                                   1526 ;   Parameters:
                                   1527 ;     HL: reg
                                   1528 ;   Returns: Flags: Z:        Div OK
                                   1529 ;                   NZ:       Div Error
                                   1530 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      00061E                       1531 div_acc_by_reg:
                                   1532 
                                   1533     ;return div_reg2_by_reg1(reg, acc);
      00061E 11 00 40         [10] 1534 	ld	de,#acc
      000621 C3 46 04         [10] 1535 	jp	div_reg2_by_reg1
                                   1536 
                                   1537 ;///////////////////////////////////////////////////////////////////////////////
                                   1538 ;   print_int_part
                                   1539 ;   void print_int_part(const uint8_t *reg);
                                   1540 ;   Parameters:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 29.
Hexadecimal [24-Bits]



                                   1541 ;     HL: reg
                                   1542 ;   Returns: Nothing
                                   1543 ;   Affects: BC DE HL AF
      000624                       1544 print_int_part_digit:
                                   1545 
      000624 1E 00            [ 7] 1546 	ld	e,#0
      000626 AF               [ 4] 1547 	xor	a
                                   1548 
      000627                       1549 print_int_part_digit_0:
                                   1550 
      000627 ED 42            [15] 1551 	sbc	hl,bc
      000629 28 08            [12] 1552 	jr	z,print_int_part_digit_2b
      00062B 38 03            [12] 1553 	jr	c,print_int_part_digit_2a
      00062D 1C               [ 4] 1554 	inc	e
      00062E 18 F7            [12] 1555 	jr	print_int_part_digit_0
                                   1556 
      000630                       1557 print_int_part_digit_2a:
      000630 09               [11] 1558 	add	hl,bc
      000631 18 01            [12] 1559 	jr	print_int_part_digit_2
                                   1560 
      000633                       1561 print_int_part_digit_2b:
      000633 1C               [ 4] 1562 	inc	e
                                   1563 
      000634                       1564 print_int_part_digit_2:
                                   1565 
      000634 7B               [ 4] 1566 	ld	a,e
      000635 B7               [ 4] 1567 	or	a
      000636 20 03            [12] 1568 	jr	nz,print_int_part_digit_3
                                   1569 
      000638 CB 42            [ 8] 1570 	bit 0,d
      00063A C8               [11] 1571 	ret	z
                                   1572 
      00063B                       1573 print_int_part_digit_3:
                                   1574 
      00063B 16 01            [ 7] 1575 	ld	d,#1
      00063D C6 30            [ 7] 1576 	add	a,#'0'
      00063F CF               [11] 1577 	rst	0x08
      000640 C9               [10] 1578 	ret
                                   1579 
      000641                       1580 print_int_part:
                                   1581 
      000641 46               [ 7] 1582 	ld	b,(hl)
      000642 23               [ 6] 1583 	inc	hl
      000643 4E               [ 7] 1584 	ld	c,(hl)
      000644 69               [ 4] 1585 	ld	l,c
      000645 60               [ 4] 1586 	ld	h,b
                                   1587 
      000646 16 00            [ 7] 1588 	ld	d,#0
      000648 01 10 27         [10] 1589 	ld	bc,#10000
      00064B CD 24 06         [17] 1590 	call	print_int_part_digit
      00064E 01 E8 03         [10] 1591 	ld	bc,#1000
      000651 CD 24 06         [17] 1592 	call	print_int_part_digit
      000654 01 64 00         [10] 1593 	ld	bc,#100
      000657 CD 24 06         [17] 1594 	call	print_int_part_digit
      00065A 01 0A 00         [10] 1595 	ld	bc,#10
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 30.
Hexadecimal [24-Bits]



      00065D CD 24 06         [17] 1596 	call	print_int_part_digit
                                   1597     	;ld bc,#1
                                   1598     	;call print_int_part_digit
      000660 7D               [ 4] 1599 	ld	a,l
      000661 C6 30            [ 7] 1600 	add	a,#'0'
      000663 CF               [11] 1601 	rst	0x08
      000664 C9               [10] 1602 	ret
                                   1603 
                                   1604 ;///////////////////////////////////////////////////////////////////////////////
                                   1605 ;   print_bc
                                   1606 ;   Internal function for debugging
                                   1607 ;   Parameters:
                                   1608 ;     BC: value to print
                                   1609 ;   Returns: Nothing
                                   1610 ;   Affects: BC DE HL AF
      000665                       1611 print_bc:
                                   1612 
      000665 69               [ 4] 1613 	ld	l,c
      000666 60               [ 4] 1614 	ld	h,b
                                   1615 
      000667 16 00            [ 7] 1616 	ld	d,#0
      000669 01 10 27         [10] 1617 	ld	bc,#10000
      00066C CD 24 06         [17] 1618 	call	print_int_part_digit
      00066F 01 E8 03         [10] 1619 	ld	bc,#1000
      000672 CD 24 06         [17] 1620 	call	print_int_part_digit
      000675 01 64 00         [10] 1621 	ld	bc,#100
      000678 CD 24 06         [17] 1622 	call	print_int_part_digit
      00067B 01 0A 00         [10] 1623 	ld	bc,#10
      00067E CD 24 06         [17] 1624 	call	print_int_part_digit
      000681 7D               [ 4] 1625 	ld	a,l
      000682 C6 30            [ 7] 1626 	add	a,#'0'
      000684 CF               [11] 1627 	rst	0x08
      000685 C9               [10] 1628 	ret
                                   1629 
                                   1630 ;///////////////////////////////////////////////////////////////////////////////
                                   1631 ;   print_reg_decimal
                                   1632 ;   void print_reg_decimal(const uint8_t *reg, int nplaces);
                                   1633 ;   Parameters:
                                   1634 ;     HL: reg
                                   1635 ;     BC: nplaces
                                   1636 ;   Returns: Nothing
                                   1637 ;   Affects: BC DE HL AF
      000686                       1638 print_reg_decimal:
                                   1639 
      000686 DD E5            [15] 1640 	push	ix
      000688 DD 21 EA FF      [14] 1641 	ld	ix,#(0xFFF8-NBYTES)    ; Allocates 8 bytes + buffer
      00068C DD 39            [15] 1642 	add	ix,sp
      00068E DD F9            [10] 1643 	ld	sp,ix
      000690 DD 75 00         [19] 1644 	ld	(ix),l
      000693 DD 74 01         [19] 1645 	ld	1(ix),h         ; IX+0, IX+1: reg
                                   1646 
                                   1647     ;uint8_t regtmp[NBYTES];
      000696 DD                    1648 	.db	0xdd
      000697 5D               [ 4] 1649 	ld	e,l
      000698 DD                    1650 	.db	0xdd
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 31.
Hexadecimal [24-Bits]



      000699 54               [ 4] 1651 	ld	d,h            ; Copia IX em DE
      00069A 21 08 00         [10] 1652 	ld	HL,#8
      00069D 19               [11] 1653 	add	hl,de
      00069E DD 75 02         [19] 1654 	ld	2(ix),l
      0006A1 DD 74 03         [19] 1655 	ld	3(ix),h         ; IX+2, IX+3: regtmp
                                   1656 
                                   1657 ;    print_int_part(reg);
                                   1658 ;    printf(".");
      0006A4 DD 6E 00         [19] 1659 	ld	l,(ix)
      0006A7 DD 66 01         [19] 1660 	ld	h,1(ix)         ; IX+0, IX+1: reg
      0006AA E5               [11] 1661 	push	hl
      0006AB C5               [11] 1662 	push	bc
      0006AC CD 41 06         [17] 1663 	call	print_int_part
      0006AF C1               [10] 1664 	pop	bc
      0006B0 3E 2E            [ 7] 1665 	ld	a,#'.'
      0006B2 CF               [11] 1666 	rst	0x08
      0006B3 E1               [10] 1667 	pop	hl
                                   1668 
                                   1669 ;    memcpy(regtmp, reg, NBYTES);
      0006B4 C5               [11] 1670 	push	bc
                                   1671 
      0006B5 DD 5E 02         [19] 1672 	ld	e,2(ix)
      0006B8 DD 56 03         [19] 1673 	ld	d,3(ix)         ; IX+2, IX+3: regtmp
      0006BB 01 0E 00         [10] 1674 	ld	bc,#NBYTES
      0006BE ED B0            [21] 1675 	ldir
                                   1676 
      0006C0 C1               [10] 1677 	pop	bc
                                   1678 
      0006C1 DD 6E 02         [19] 1679 	ld	l,2(ix)
      0006C4 DD 66 03         [19] 1680 	ld	h,3(ix)         ; IX+2, IX+3: regtmp
                                   1681 
                                   1682 ;    if (nplaces)
                                   1683 ;        ++nplaces;
      0006C7 78               [ 4] 1684 	ld	a,b
      0006C8 B1               [ 4] 1685 	or	c
      0006C9 28 01            [12] 1686 	jr	z, print_reg_decimal_1
      0006CB 03               [ 6] 1687 	inc	bc
                                   1688 
      0006CC                       1689 print_reg_decimal_1:
                                   1690 
                                   1691 ;    for (;;){
                                   1692 ;        if (nplaces){
      0006CC 78               [ 4] 1693 	ld	a,b
      0006CD B1               [ 4] 1694 	or	c
      0006CE 28 05            [12] 1695 	jr	z, print_reg_decimal_2
                                   1696 
                                   1697 ;            --nplaces;
      0006D0 0B               [ 6] 1698 	dec	bc
                                   1699 ;            if (!nplaces)
                                   1700 ;                break;
      0006D1 78               [ 4] 1701 	ld	a,b
      0006D2 B1               [ 4] 1702 	or	c
      0006D3 28 1F            [12] 1703 	jr	z, print_reg_decimal_3
                                   1704 ;        }
                                   1705 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 32.
Hexadecimal [24-Bits]



      0006D5                       1706 print_reg_decimal_2:
                                   1707 
                                   1708 ;        memset(regtmp,0,NBYTES_INT);
      0006D5 AF               [ 4] 1709 	xor	a
      0006D6 77               [ 7] 1710 	ld	(hl),a
      0006D7 23               [ 6] 1711 	inc	hl
      0006D8 77               [ 7] 1712 	ld	(hl),a
      0006D9 2B               [ 6] 1713 	dec	hl
                                   1714 
                                   1715 ;        if (iszero(regtmp)) break;
      0006DA C5               [11] 1716 	push	bc
      0006DB E5               [11] 1717 	push	hl
      0006DC CD 3A 04         [17] 1718 	call	iszero
      0006DF E1               [10] 1719 	pop	hl
      0006E0 C1               [10] 1720 	pop	bc
      0006E1 28 11            [12] 1721 	jr	z, print_reg_decimal_3
                                   1722 
                                   1723 ;        mul_reg_10(regtmp);
      0006E3 C5               [11] 1724 	push	bc
      0006E4 E5               [11] 1725 	push	hl
      0006E5 5D               [ 4] 1726 	ld	e,l
      0006E6 54               [ 4] 1727 	ld	d,h
      0006E7 CD CA 03         [17] 1728 	call	mul_reg_10
      0006EA E1               [10] 1729 	pop	hl
      0006EB C1               [10] 1730 	pop	bc
                                   1731 
                                   1732 ;        print_int_part(regtmp);
      0006EC 23               [ 6] 1733 	inc	hl
      0006ED 7E               [ 7] 1734 	ld	a,(hl)
      0006EE 2B               [ 6] 1735 	dec	hl
      0006EF C6 30            [ 7] 1736 	add	a,#'0'
      0006F1 CF               [11] 1737 	rst	0x08
                                   1738 
                                   1739 ;    }
      0006F2 18 D8            [12] 1740 	jr	print_reg_decimal_1
                                   1741 
      0006F4                       1742 print_reg_decimal_3:
      0006F4                       1743 print_reg_decimal_end:
                                   1744 
      0006F4 21 16 00         [10] 1745 	ld	hl,#(0x0008+NBYTES)    ; Frees 8 bytes + buffer
      0006F7 39               [11] 1746 	add	hl,sp
      0006F8 F9               [ 6] 1747 	ld	sp,hl
      0006F9 DD E1            [14] 1748 	pop	ix
      0006FB C9               [10] 1749 	ret
                                   1750 
                                   1751 ;///////////////////////////////////////////////////////////////////////////////
                                   1752 ;   println_reg_decimal
                                   1753 ;   void println_reg_decimal(const uint8_t *reg, int nplaces);
                                   1754 ;   Parameters:
                                   1755 ;     HL: reg
                                   1756 ;     BC: nplaces
                                   1757 ;   Returns: Nothing
                                   1758 ;   Affects: BC DE HL AF
      0006FC                       1759 println_reg_decimal:
                                   1760 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 33.
Hexadecimal [24-Bits]



      0006FC CD 86 06         [17] 1761 	call	print_reg_decimal
      0006FF CD 6F 00         [17] 1762 	call	print_crlf
      000702 C9               [10] 1763 	ret
                                   1764 
                                   1765 ;///////////////////////////////////////////////////////////////////////////////
                                   1766 ;   test_pi_bbp
                                   1767 ;   void test_pi_bbp(void); // Bailey-Borwein-Plouffe
                                   1768 ;   Parameters: Nothing
                                   1769 ;   Returns: Nothing
                                   1770 ;   Affects: BC DE HL AF
      000703                       1771 test_pi_bbp:
                                   1772 
      000703 DD E5            [15] 1773 	push	ix
      000705 DD 21 CC FF      [14] 1774 	ld	ix,#(0xFFF6-3*NBYTES)    ; Allocates 10 bytes + 3 buffers
      000709 DD 39            [15] 1775 	add	ix,sp
      00070B DD F9            [10] 1776 	ld	sp,ix
                                   1777 
                                   1778 ;    uint8_t regtotal[NBYTES];
      00070D DD                    1779 	.db	0xdd
      00070E 4D               [ 4] 1780 	ld	c,l
      00070F DD                    1781 	.db	0xdd
      000710 44               [ 4] 1782 	ld	b,h            ; IX -> BC
      000711 21 0A 00         [10] 1783 	ld	HL,#10
      000714 09               [11] 1784 	add	hl,bc
      000715 DD 75 00         [19] 1785 	ld	(ix),l
      000718 DD 74 01         [19] 1786 	ld	1(ix),h         ; IX+0, IX+1: regtotal
                                   1787 
                                   1788 ;    uint8_t regsubtotal[NBYTES];
      00071B 01 0E 00         [10] 1789 	ld	bc,#NBYTES
      00071E 09               [11] 1790 	add	hl,bc
      00071F DD 75 02         [19] 1791 	ld	2(ix),l
      000722 DD 74 03         [19] 1792 	ld	3(ix),h         ; IX+2, IX+3: regsubtotal
                                   1793 
                                   1794 ;    uint8_t regden[NBYTES];
                                   1795     ;ld bc,#NBYTES
      000725 09               [11] 1796 	add	hl,bc
      000726 DD 75 04         [19] 1797 	ld	4(ix),l
      000729 DD 74 05         [19] 1798 	ld	5(ix),h         ; IX+4, IX+5: regden
                                   1799 
                                   1800 ;    zero_reg(regtotal);
      00072C DD 6E 00         [19] 1801 	ld	l,(ix)
      00072F DD 66 01         [19] 1802 	ld	h,1(ix)         ; IX+0, IX+1: regtotal
      000732 CD 76 00         [17] 1803 	call	zero_reg
                                   1804 
                                   1805 ;    for (int k = 0; k < 10000; k++){
      000735 01 00 00         [10] 1806 	ld	bc,#0
                                   1807 
      000738                       1808 test_pi_bbp_1:
                                   1809 
      000738 DD 71 06         [19] 1810 	ld	6(ix),c
      00073B DD 70 07         [19] 1811 	ld	7(ix),b         ; IX+6, IX+7: k
                                   1812 
      00073E 78               [ 4] 1813 	ld	a,b
      00073F FE 00            [ 7] 1814 	cp	#(NUM_IT >> 8)
      000741 38 08            [12] 1815 	jr	c, test_pi_bbp_1a
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 34.
Hexadecimal [24-Bits]



                                   1816 
      000743 79               [ 4] 1817 	ld	a,c
      000744 FE 18            [ 7] 1818 	cp	#(NUM_IT & 0xff)
      000746 38 03            [12] 1819 	jr	c, test_pi_bbp_1a
                                   1820 
      000748 C3 59 08         [10] 1821 	jp	test_pi_bbp_2
                                   1822 
      00074B                       1823 test_pi_bbp_1a:
                                   1824 
                                   1825 ;        zero_reg(regsubtotal);
      00074B DD 6E 02         [19] 1826 	ld	l,2(ix)
      00074E DD 66 03         [19] 1827 	ld	h,3(ix)         ; IX+2, IX+3: regsubtotal
      000751 CD 76 00         [17] 1828 	call	zero_reg
                                   1829 
                                   1830 ;        zero_reg(regden);
      000754 DD 6E 04         [19] 1831 	ld	l,4(ix)
      000757 DD 66 05         [19] 1832 	ld	h,5(ix)         ; IX+4, IX+5: regden
      00075A E5               [11] 1833 	push	hl
      00075B CD 76 00         [17] 1834 	call	zero_reg
      00075E D1               [10] 1835 	pop	de              ; DE has regden
                                   1836 
                                   1837 ;        load_reg_int(regden,8*k+1);     // Sets 8k+1
      00075F DD 6E 06         [19] 1838 	ld	l,6(ix)
      000762 DD 66 07         [19] 1839 	ld	h,7(ix)         ; IX+6, IX+7: k
      000765 CB 25            [ 8] 1840 	sla	l
      000767 CB 14            [ 8] 1841 	rl	h
      000769 CB 25            [ 8] 1842 	sla	l
      00076B CB 14            [ 8] 1843 	rl	h
      00076D CB 25            [ 8] 1844 	sla	l
      00076F CB 14            [ 8] 1845 	rl	h
      000771 23               [ 6] 1846 	inc	hl
      000772 CD EA 00         [17] 1847 	call	load_reg_int   ; DE is correct here
                                   1848 
                                   1849 ;        zero_reg(acc);
      000775 21 00 40         [10] 1850 	ld	hl,#acc
      000778 CD 76 00         [17] 1851 	call	zero_reg
                                   1852 
                                   1853 ;        set_bit_reg_int(acc, 2);        // Sets with 4
      00077B 21 00 40         [10] 1854 	ld	hl,#acc
      00077E 01 02 00         [10] 1855 	ld	bc,#2
      000781 CD AB 00         [17] 1856 	call	set_bit_reg_int
                                   1857 
                                   1858 ;        div_acc_by_reg(regden);
      000784 DD 6E 04         [19] 1859 	ld	l,4(ix)
      000787 DD 66 05         [19] 1860 	ld	h,5(ix)         ; IX+4, IX+5: regden
      00078A CD 1E 06         [17] 1861 	call	div_acc_by_reg
                                   1862 
                                   1863 ;        add_reg2_to_reg1(regsubtotal,acc);
      00078D DD 5E 02         [19] 1864 	ld	e,2(ix)
      000790 DD 56 03         [19] 1865 	ld	d,3(ix)         ; IX+2, IX+3: regsubtotal
      000793 21 00 40         [10] 1866 	ld	hl,#acc
      000796 CD B1 00         [17] 1867 	call	add_reg2_to_reg1
                                   1868 
                                   1869 ;        inc_reg_int8(regden, 3);        // 8k+4
      000799 DD 5E 04         [19] 1870 	ld	e,4(ix)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 35.
Hexadecimal [24-Bits]



      00079C DD 56 05         [19] 1871 	ld	d,5(ix)         ; IX+4, IX+5: regden
      00079F 3E 03            [ 7] 1872 	ld	a,#3
      0007A1 CD D4 00         [17] 1873 	call	inc_reg_int8
                                   1874 
                                   1875 ;        zero_reg(acc);
      0007A4 21 00 40         [10] 1876 	ld	hl,#acc
      0007A7 CD 76 00         [17] 1877 	call	zero_reg
                                   1878 
                                   1879 ;        set_bit_reg_int(acc, 1);        // Sets with 2
      0007AA 21 00 40         [10] 1880 	ld	hl,#acc
      0007AD 01 01 00         [10] 1881 	ld	bc,#1
      0007B0 CD AB 00         [17] 1882 	call	set_bit_reg_int
                                   1883 
                                   1884 ;        div_acc_by_reg(regden);
      0007B3 DD 6E 04         [19] 1885 	ld	l,4(ix)
      0007B6 DD 66 05         [19] 1886 	ld	h,5(ix)         ; IX+4, IX+5: regden
      0007B9 CD 1E 06         [17] 1887 	call	div_acc_by_reg
                                   1888 
                                   1889 ;        sub_reg2_from_reg1(regsubtotal,acc);
      0007BC 21 00 40         [10] 1890 	ld	hl,#acc
      0007BF DD 5E 02         [19] 1891 	ld	e,2(ix)
      0007C2 DD 56 03         [19] 1892 	ld	d,3(ix)         ; IX+2, IX+3: regsubtotal
      0007C5 CD 03 01         [17] 1893 	call	sub_reg2_from_reg1
                                   1894 
                                   1895 ;        inc_reg_int8(regden, 1);        // 8k+5
      0007C8 DD 5E 04         [19] 1896 	ld	e,4(ix)
      0007CB DD 56 05         [19] 1897 	ld	d,5(ix)         ; IX+4, IX+5: regden
      0007CE 3E 01            [ 7] 1898 	ld	a,#1
      0007D0 CD D4 00         [17] 1899 	call	inc_reg_int8
                                   1900 
                                   1901 ;        zero_reg(acc);
      0007D3 21 00 40         [10] 1902 	ld	hl,#acc
      0007D6 CD 76 00         [17] 1903 	call	zero_reg
                                   1904 
                                   1905 ;        set_bit_reg_int(acc, 0);        // Sets with 1
      0007D9 21 00 40         [10] 1906 	ld	hl,#acc
      0007DC 01 00 00         [10] 1907 	ld	bc,#0
      0007DF CD AB 00         [17] 1908 	call	set_bit_reg_int
                                   1909 
                                   1910 ;        div_acc_by_reg(regden);
      0007E2 DD 6E 04         [19] 1911 	ld	l,4(ix)
      0007E5 DD 66 05         [19] 1912 	ld	h,5(ix)         ; IX+4, IX+5: regden
      0007E8 CD 1E 06         [17] 1913 	call	div_acc_by_reg
                                   1914 
                                   1915 ;        sub_reg2_from_reg1(regsubtotal,acc);
      0007EB 21 00 40         [10] 1916 	ld	hl,#acc
      0007EE DD 5E 02         [19] 1917 	ld	e,2(ix)
      0007F1 DD 56 03         [19] 1918 	ld	d,3(ix)         ; IX+2, IX+3: regsubtotal
      0007F4 CD 03 01         [17] 1919 	call	sub_reg2_from_reg1
                                   1920 
                                   1921 ;        inc_reg_int8(regden, 1);        // 8k+6
      0007F7 DD 5E 04         [19] 1922 	ld	e,4(ix)
      0007FA DD 56 05         [19] 1923 	ld	d,5(ix)         ; IX+4, IX+5: regden
      0007FD 3E 01            [ 7] 1924 	ld	a,#1
      0007FF CD D4 00         [17] 1925 	call	inc_reg_int8
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 36.
Hexadecimal [24-Bits]



                                   1926 
                                   1927 ;        zero_reg(acc);
      000802 21 00 40         [10] 1928 	ld	hl,#acc
      000805 CD 76 00         [17] 1929 	call	zero_reg
                                   1930 
                                   1931 ;        set_bit_reg_int(acc, 0);        // Sets with 1
      000808 21 00 40         [10] 1932 	ld	hl,#acc
      00080B 01 00 00         [10] 1933 	ld	bc,#0
      00080E CD AB 00         [17] 1934 	call	set_bit_reg_int
                                   1935 
                                   1936 ;        div_acc_by_reg(regden);
      000811 DD 6E 04         [19] 1937 	ld	l,4(ix)
      000814 DD 66 05         [19] 1938 	ld	h,5(ix)         ; IX+4, IX+5: regden
      000817 CD 1E 06         [17] 1939 	call	div_acc_by_reg
                                   1940 
                                   1941 ;        sub_reg2_from_reg1(regsubtotal,acc);
      00081A 21 00 40         [10] 1942 	ld	hl,#acc
      00081D DD 5E 02         [19] 1943 	ld	e,2(ix)
      000820 DD 56 03         [19] 1944 	ld	d,3(ix)         ; IX+2, IX+3: regsubtotal
      000823 CD 03 01         [17] 1945 	call	sub_reg2_from_reg1
                                   1946 
                                   1947 ;        shr_reg(regsubtotal, 4*k);
      000826 DD 5E 02         [19] 1948 	ld	e,2(ix)
      000829 DD 56 03         [19] 1949 	ld	d,3(ix)         ; IX+2, IX+3: regsubtotal
      00082C DD 4E 06         [19] 1950 	ld	c,6(ix)
      00082F DD 46 07         [19] 1951 	ld	b,7(ix)         ; IX+6, IX+7: k
      000832 CB 21            [ 8] 1952 	sla	c
      000834 CB 10            [ 8] 1953 	rl	b
      000836 CB 21            [ 8] 1954 	sla	c
      000838 CB 10            [ 8] 1955 	rl	b
      00083A CD E4 01         [17] 1956 	call	shr_reg
                                   1957 
                                   1958 ;        add_reg2_to_reg1(regtotal, regsubtotal);
      00083D DD 5E 00         [19] 1959 	ld	e,(ix)
      000840 DD 56 01         [19] 1960 	ld	d,1(ix)         ; IX+0, IX+1: regtotal
      000843 DD 6E 02         [19] 1961 	ld	l,2(ix)
      000846 DD 66 03         [19] 1962 	ld	h,3(ix)         ; IX+2, IX+3: regsubtotal
      000849 CD B1 00         [17] 1963 	call	add_reg2_to_reg1
                                   1964 
                                   1965 ;;        if (!(k % 10)){
                                   1966 ;;            printf("%5d: ",k);
                                   1967 ;;            print_reg_decimal(regtotal, 120);
                                   1968 ;;            int places_ok = compare_digits_to_pi(regtotal);
                                   1969 ;;            printf(" (%d)\n",places_ok);
                                   1970 ;;            if (places_ok >= 1000) return;
                                   1971 ;;        }
                                   1972 ;            print_reg_decimal(regtotal, 120);
      00084C 3E 2A            [ 7] 1973 	ld	a,#'*'
      00084E CF               [11] 1974 	rst	0x08
                                   1975 	;ld l,(ix)
                                   1976 	;ld h,1(ix)         ; IX+0, IX+1: regtotal
                                   1977 	;ld bc,NUM_DECS
                                   1978 	;call println_reg_decimal
                                   1979 
                                   1980 ;    }
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 37.
Hexadecimal [24-Bits]



      00084F DD 4E 06         [19] 1981 	ld	c,6(ix)
      000852 DD 46 07         [19] 1982 	ld	b,7(ix)         ; IX+6, IX+7: k
      000855 03               [ 6] 1983 	inc	bc
                                   1984 	;ld 6(ix),c
                                   1985 	;ld 7(ix),b         ; IX+6, IX+7: k
                                   1986 
      000856 C3 38 07         [10] 1987 	jp	test_pi_bbp_1
                                   1988 
      000859                       1989 test_pi_bbp_2:
      000859                       1990 test_pi_bbp_end:
                                   1991 
      000859 CD FE 08         [17] 1992 	call	lcd_clear
      00085C 21 76 08         [10] 1993 	ld	hl,#msg_pi
      00085F CD D0 08         [17] 1994 	call	lcd_wmsg
      000862 DD 6E 00         [19] 1995 	ld	l,(ix)
      000865 DD 66 01         [19] 1996 	ld	h,1(ix)         ; IX+0, IX+1: regtotal
      000868 01 1B 00         [10] 1997 	ld	bc,#NUM_DECS
                                   1998     ;call println_reg_decimal
      00086B CD 86 06         [17] 1999 	call	print_reg_decimal
                                   2000 
      00086E 21 34 00         [10] 2001 	ld	hl,#(0x000A+3*NBYTES)    ; Frees 10 bytes + 3 buffers
      000871 39               [11] 2002 	add	hl,sp
      000872 F9               [ 6] 2003 	ld	sp,hl
      000873 DD E1            [14] 2004 	pop	ix
      000875 C9               [10] 2005 	ret
                                   2006 
      000876 50 49 3A 00           2007 msg_pi:	.ascii	"PI:\0"
                                   2008 
                                   2009 ;///////////////////////////////////////////////////////////////////////////////
                                   2010 ;   _main
                                   2011 ;   void _main(void);
                                   2012 ;   Parameters: Nothing
                                   2013 ;   Returns: Nothing
                                   2014 ;   Affects: BC DE HL AF IY BC' DE' HL' AF'
      00087A                       2015 _main:
                                   2016 
      00087A CD 10 09         [17] 2017 	call	lcd_init
      00087D CD 84 08         [17] 2018 	call	msg_init     ;escreve tÃ­tulo "Alpha Z80" 
      000880 CD 03 07         [17] 2019 	call	test_pi_bbp
      000883 C9               [10] 2020 	ret
                                   2021 
                                   2022 ; =============================================================================
                                   2023 ; --- Imprime o tÃ­tulo na segunda linha do LCD ---
      000884                       2024 msg_init:
      000884 CD EB 08         [17] 2025 	call	lcd_home2
      000887 21 8D 08         [10] 2026 	ld	hl,#msg_picalc
      00088A C3 D0 08         [10] 2027 	jp	lcd_wmsg
                                   2028 
      00088D                       2029 msg_picalc:    
      00088D 50 49 43 41 4C 43 20  2030 	.ascii "PICALC 1.0\0"
             31 2E 30 00
                                   2031 
                                   2032 	;///////////////////////////////////////////////////////////////////////
                                   2033 	;//////////////////////   LCD DISPLAY FUNCTIONS   //////////////////////
                                   2034 	;///////////////////////////////////////////////////////////////////////
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 38.
Hexadecimal [24-Bits]



                                   2035 
      000898                       2036 lcd_write:
                                   2037 	;RS R/W DB7 DB6 DB5 DB4
                                   2038 	;1   0   D7  D6  D5  D4
      000898 C5               [11] 2039 	push	bc
                                   2040 
      000899 F5               [11] 2041 	push	af
      00089A 3A 0E 40         [13] 2042 	ld	a,(dispcol)
      00089D FE 10            [ 7] 2043 	cp	#16
      00089F 20 05            [12] 2044 	jr	nz,lcd_w1
      0008A1 CD EB 08         [17] 2045 	call	lcd_home2
      0008A4 18 07            [12] 2046 	jr	lcd_w2
      0008A6                       2047 lcd_w1:
      0008A6 FE 20            [ 7] 2048 	cp	#32
      0008A8 20 03            [12] 2049 	jr	nz,lcd_w2
      0008AA CD D9 08         [17] 2050 	call	lcd_home
      0008AD                       2051 lcd_w2:
      0008AD 3A 0E 40         [13] 2052 	ld	a,(dispcol)
      0008B0 3C               [ 4] 2053 	inc	a
      0008B1 32 0E 40         [13] 2054 	ld	(dispcol),a
      0008B4 F1               [10] 2055 	pop	af
                                   2056 	
      0008B5 4F               [ 4] 2057 	ld	c,a
      0008B6 E6 F0            [ 7] 2058 	and	#0xf0
      0008B8 F6 01            [ 7] 2059 	or	#0x01
      0008BA CD 63 09         [17] 2060 	call	lcd_out
                                   2061 
                                   2062 	;RS R/W DB7 DB6 DB5 DB4
                                   2063 	;1   0   D3  D2  D1  D0
      0008BD 79               [ 4] 2064 	ld	a,c		
      0008BE CB 27            [ 8] 2065 	sla	a
      0008C0 CB 27            [ 8] 2066 	sla	a
      0008C2 CB 27            [ 8] 2067 	sla	a
      0008C4 CB 27            [ 8] 2068 	sla	a
      0008C6 F6 01            [ 7] 2069 	or	#0x01
      0008C8 CD 63 09         [17] 2070 	call	lcd_out
                                   2071 
      0008CB CD 72 09         [17] 2072 	call	delay_5ms
                                   2073 
      0008CE C1               [10] 2074 	pop	bc
                                   2075 
      0008CF C9               [10] 2076 	ret
                                   2077 
                                   2078 ;///////////////////////////////////////////////////////////////////////////////
      0008D0                       2079 lcd_wmsg:	
      0008D0 7E               [ 7] 2080 	ld	a,(hl)
      0008D1 B7               [ 4] 2081 	or	a
      0008D2 C8               [11] 2082 	ret	z
      0008D3 CD 98 08         [17] 2083 	call	lcd_write
      0008D6 23               [ 6] 2084 	inc	hl
      0008D7 18 F7            [12] 2085 	jr	lcd_wmsg
                                   2086 
                                   2087 ;///////////////////////////////////////////////////////////////////////////////
      0008D9                       2088 lcd_home:
                                   2089 	;RS R/W DB7 DB6 DB5 DB4
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 39.
Hexadecimal [24-Bits]



                                   2090 	;0   0   0   0   0   0
      0008D9 3E 00            [ 7] 2091 	ld	a,#0b00000000
      0008DB CD 63 09         [17] 2092 	call	lcd_out
                                   2093 	;RS R/W DB3 DB2 DB1 DB0
                                   2094 	;0   0   0   0   1   0
      0008DE 3E 20            [ 7] 2095 	ld	a,#0b00100000
      0008E0 CD 63 09         [17] 2096 	call	lcd_out
                                   2097 
      0008E3 CD 72 09         [17] 2098 	call	delay_5ms
      0008E6 AF               [ 4] 2099 	xor a
      0008E7 32 0E 40         [13] 2100 	ld (dispcol),a
      0008EA C9               [10] 2101 	ret
                                   2102 
                                   2103 ;///////////////////////////////////////////////////////////////////////////////
      0008EB                       2104 lcd_home2:
                                   2105 	;RS R/W DB7 DB6 DB5 DB4
                                   2106 	;0   0   1   1   0   0
      0008EB 3E C0            [ 7] 2107 	ld	a,#0b11000000
      0008ED CD 63 09         [17] 2108 	call	lcd_out
                                   2109 	;RS R/W DB3 DB2 DB1 DB0
                                   2110 	;0   0   0   0   0   0
      0008F0 3E 00            [ 7] 2111 	ld	a,#0b00000000
      0008F2 CD 63 09         [17] 2112 	call	lcd_out
                                   2113 
      0008F5 CD 72 09         [17] 2114 	call	delay_5ms
      0008F8 3E 10            [ 7] 2115 	ld a,#16
      0008FA 32 0E 40         [13] 2116 	ld (dispcol),a
      0008FD C9               [10] 2117 	ret
                                   2118 
                                   2119 ;///////////////////////////////////////////////////////////////////////////////
      0008FE                       2120 lcd_clear:
                                   2121 	;RS R/W DB7 DB6 DB5 DB4
                                   2122 	;0   0   0   0   0   0
      0008FE 3E 00            [ 7] 2123 	ld	a,#0b00000000
      000900 CD 63 09         [17] 2124 	call	lcd_out
                                   2125 	;RS R/W DB3 DB2 DB1 DB0
                                   2126 	;0   0   0   0   0   1
      000903 3E 10            [ 7] 2127 	ld	a,#0b00010000
      000905 CD 63 09         [17] 2128 	call	lcd_out
                                   2129 
      000908 CD 72 09         [17] 2130 	call	delay_5ms
      00090B AF               [ 4] 2131 	xor a
      00090C 32 0E 40         [13] 2132 	ld (dispcol),a
      00090F C9               [10] 2133 	ret
                                   2134 
                                   2135 ;///////////////////////////////////////////////////////////////////////////////
      000910                       2136 lcd_init:
      000910 CD 7B 09         [17] 2137 	call	delay_15ms
                                   2138 
                                   2139 	;RS R/W DB7 DB6 DB5 DB4
                                   2140 	;0   0   0   0   1   1
      000913 3E 30            [ 7] 2141 	ld	a,#0b00110000
      000915 CD 63 09         [17] 2142 	call	lcd_out
      000918 CD 72 09         [17] 2143 	call	delay_5ms
      00091B 3E 30            [ 7] 2144 	ld	a,#0b00110000
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 40.
Hexadecimal [24-Bits]



      00091D CD 63 09         [17] 2145 	call	lcd_out
      000920 CD 72 09         [17] 2146 	call	delay_5ms
                                   2147 
                                   2148 	;RS R/W DB7 DB6 DB5 DB4
                                   2149 	;0   0   0   0   1   0
      000923 3E 20            [ 7] 2150 	ld	a,#0b00100000		; Set 4 bit mode
      000925 CD 63 09         [17] 2151 	call	lcd_out
                                   2152 
      000928 CD 72 09         [17] 2153 	call	delay_5ms
                                   2154 
                                   2155 	;RS R/W DB7 DB6 DB5 DB4
                                   2156 	;0   0   0   0   1   0
      00092B 3E 20            [ 7] 2157 	ld	a,#0b00100000		; Will set N F
      00092D CD 63 09         [17] 2158 	call	lcd_out
                                   2159 	;RS R/W DB3 DB2 DB1 DB0
                                   2160 	;0   0   N   F   x   x  N=1 F=1
      000930 3E C0            [ 7] 2161 	ld	a,#0b11000000
      000932 CD 63 09         [17] 2162 	call	lcd_out
                                   2163 
      000935 CD 72 09         [17] 2164 	call	delay_5ms
                                   2165 
                                   2166 	;RS R/W DB7 DB6 DB5 DB4
                                   2167 	;0   0   0   0   0   0
      000938 3E 00            [ 7] 2168 	ld	a,#0b00000000		; Will turn display on
      00093A CD 63 09         [17] 2169 	call	lcd_out
                                   2170 	;RS R/W DB3 DB2 DB1 DB0
                                   2171 	;0   0   1   1   0   0
      00093D 3E C0            [ 7] 2172 	ld	a,#0b11000000
      00093F CD 63 09         [17] 2173 	call	lcd_out
                                   2174 
      000942 CD 72 09         [17] 2175 	call	delay_5ms
                                   2176 
                                   2177 	;RS R/W DB7 DB6 DB5 DB4
                                   2178 	;0   0   0   0   0   0
      000945 3E 00            [ 7] 2179 	ld	a,#0b00000000		; Will clear display
      000947 CD 63 09         [17] 2180 	call	lcd_out
                                   2181 	;RS R/W DB3 DB2 DB1 DB0
                                   2182 	;0   0   0   0   0   1
      00094A 3E 10            [ 7] 2183 	ld	a,#0b00010000
      00094C CD 63 09         [17] 2184 	call	lcd_out
                                   2185 
      00094F CD 72 09         [17] 2186 	call	delay_5ms
                                   2187 
                                   2188 	;RS R/W DB7 DB6 DB5 DB4
                                   2189 	;0   0   0   0   0   0
      000952 3E 00            [ 7] 2190 	ld	a,#0b00000000		; Will set Increment mode
      000954 CD 63 09         [17] 2191 	call	lcd_out		; No shift
                                   2192 	;RS R/W DB3 DB2 DB1 DB0
                                   2193 	;0   0   0   1   1   0
      000957 3E 60            [ 7] 2194 	ld	a,#0b01100000
      000959 CD 63 09         [17] 2195 	call	lcd_out
                                   2196 
      00095C CD 72 09         [17] 2197 	call	delay_5ms
                                   2198 
      00095F CD D9 08         [17] 2199 	call	lcd_home
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 41.
Hexadecimal [24-Bits]



      000962 C9               [10] 2200 	ret
                                   2201 
                                   2202 ;///////////////////////////////////////////////////////////////////////////////
      000963                       2203 lcd_out:
      000963 D3 10            [11] 2204 	out	(PORTDISP),a
      000965 00               [ 4] 2205 	nop
      000966 00               [ 4] 2206 	nop
      000967 CB CF            [ 8] 2207 	set	1,a
      000969 D3 10            [11] 2208 	out	(PORTDISP),a
      00096B 00               [ 4] 2209 	nop
      00096C 00               [ 4] 2210 	nop
      00096D CB 8F            [ 8] 2211 	res	1,a
      00096F D3 10            [11] 2212 	out	(PORTDISP),a
      000971 C9               [10] 2213 	ret
                                   2214 
                                   2215 ;///////////////////////////////////////////////////////////////////////////////
      000972                       2216 delay_5ms:	
      000972 01 00 03         [10] 2217 	ld	bc,#768		; 2.5us
      000975                       2218 delay_5ms_a:	
      000975 0B               [ 6] 2219 	dec	bc		; 1.5 us
      000976 78               [ 4] 2220 	ld	a,b		; 1 us
      000977 B1               [ 4] 2221 	or	c		; 1 us
      000978 20 FB            [12] 2222 	jr	nz,delay_5ms_a	; 3 us
      00097A C9               [10] 2223 	ret			; 2.5 us
                                   2224 
                                   2225 ;///////////////////////////////////////////////////////////////////////////////
      00097B                       2226 delay_15ms:	
      00097B 01 03 09         [10] 2227 	ld	bc,#2307	; 2.5us
      00097E                       2228 delay_15ms_a:	
      00097E 0B               [ 6] 2229 	dec	bc		; 1.5 us
      00097F 78               [ 4] 2230 	ld	a,b		; 1 us
      000980 B1               [ 4] 2231 	or	c		; 1 us
      000981 20 FB            [12] 2232 	jr	nz,delay_15ms_a	; 3 us
      000983 C9               [10] 2233 	ret			; 2.5 us
                                   2234 
                                   2235 ;///////////////////////////////////////////////////////////////////////////////
      004000                       2236     .org RAMBASE
                                   2237 
      004000                       2238 acc:	.ds NBYTES   ; Global variable, to make things a bit easier.
      00400E                       2239 dispcol:.ds 1
                                   2240 
                                   2241 	.area _DATA
                                   2242 
                                   2243 ;	.end
                                   2244 
